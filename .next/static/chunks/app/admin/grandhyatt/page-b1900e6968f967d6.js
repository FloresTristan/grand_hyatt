(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[747],{528:(e,t,l)=>{"use strict";l.d(t,{B:()=>o});var n=l(5155);l(2115);var a=l(6766),s=l(8882),r=l(5808),i=l(7149);function o(e){let{open:t,src:l,alt:o="",onClose:d,imageRef:c}=e;return(0,n.jsx)(s.A,{open:t,onClose:d,maxWidth:!1,PaperProps:{sx:{bgcolor:"transparent",boxShadow:"none",borderRadius:2}},children:(0,n.jsx)(r.A,{sx:{p:0,position:"relative",width:{xs:"95vw",sm:"90vw"},height:{xs:"80vh",sm:"85vh"},overflow:"hidden",bgcolor:"transparent"},children:(0,n.jsx)(i.A,{sx:{position:"relative",width:"100%",height:"100%"},children:(0,n.jsx)(a.default,{ref:c,src:l,alt:o,fill:!0,sizes:"100vw",priority:!0,className:"object-contain object-center"})})})})}},644:(e,t,l)=>{"use strict";l.d(t,{A:()=>s});var n=l(7515),a=l(5155);let s=(0,n.A)((0,a.jsx)("path",{d:"m14.06 9.02.92.92L5.92 19H5v-.92zM17.66 3c-.25 0-.51.1-.7.29l-1.83 1.83 3.75 3.75 1.83-1.83c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.2-.2-.45-.29-.71-.29m-3.6 3.19L3 17.25V21h3.75L17.81 9.94z"}),"EditOutlined")},3114:(e,t,l)=>{"use strict";l.d(t,{A:()=>s});var n=l(7515),a=l(5155);let s=(0,n.A)((0,a.jsx)("path",{d:"M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20z"}),"ArrowBackOutlined")},3649:(e,t,l)=>{"use strict";l.d(t,{A:()=>i});var n=l(5155),a=l(5726),s=l(2302),r=l(8534);function i(e){let{snackbarSettings:t,setSnackbarSettings:l}=e,{open:i,message:o,severity:d,actionLabel:c,actionCallback:u,duration:h}=t,m=()=>{l(e=>({...e,open:!1,actionLable:null,actionCallback:null}))};return(0,n.jsx)(a.A,{open:i,autoHideDuration:void 0!==h?h:2e3,anchorOrigin:{vertical:"top",horizontal:"center"},onClose:m,children:(0,n.jsx)(s.A,{severity:d,variant:"standard",className:"w-full",onClose:m,action:c&&u?(0,n.jsx)(r.A,{color:"error",size:"small",onClick:()=>{u&&(u(),l(e=>({...e,open:!1})))},children:c}):null,children:o})})}},3970:(e,t,l)=>{Promise.resolve().then(l.bind(l,8197))},5381:(e,t,l)=>{"use strict";l.d(t,{J:()=>o,UserProvider:()=>i});var n=l(5155),a=l(2115),s=l(6414);let r=(0,a.createContext)(void 0);function i(e){let{children:t,initialUser:l=null,initialProfile:i=null}=e,[o,d]=(0,a.useState)(l),[c,u]=(0,a.useState)(i),[h,m]=(0,a.useState)(!l),p=async()=>{m(!0);try{let{data:{user:e}}=await s.N.auth.getUser();if(d(null!=e?e:null),e){let{data:t,error:l}=await s.N.from("profiles").select("id, display_name, role, disabled, created_at").eq("id",e.id).single();l?u(null):u(t)}else u(null)}finally{m(!1)}};(0,a.useEffect)(()=>{l||p();let{data:e}=s.N.auth.onAuthStateChange(async(e,t)=>{var l;if(d(null!=(l=null==t?void 0:t.user)?l:null),null==t?void 0:t.user){let{data:e}=await s.N.from("profiles").select("id, display_name, role, disabled, created_at").eq("id",t.user.id).single();u(null!=e?e:null)}else u(null)});return()=>e.subscription.unsubscribe()},[]);let x=(0,a.useMemo)(()=>{var e,t,l;let n=null!=(t=null==o||null==(e=o.app_metadata)?void 0:e.role)?t:"user";return null!=(l=null==c?void 0:c.role)?l:n},[null==c?void 0:c.role,null==o?void 0:o.app_metadata]),v=(0,a.useMemo)(()=>({user:o,profile:c,role:x,loading:h,refresh:p,signOut:async()=>{await s.N.auth.signOut()}}),[o,c,x,h]);return(0,n.jsx)(r.Provider,{value:v,children:t})}function o(){let e=(0,a.useContext)(r);if(!e)throw Error("useUser must be used within <UserProvider>");return e}},5695:(e,t,l)=>{"use strict";var n=l(8999);l.o(n,"usePathname")&&l.d(t,{usePathname:function(){return n.usePathname}}),l.o(n,"useRouter")&&l.d(t,{useRouter:function(){return n.useRouter}}),l.o(n,"useSearchParams")&&l.d(t,{useSearchParams:function(){return n.useSearchParams}})},6414:(e,t,l)=>{"use strict";l.d(t,{N:()=>n});let n=(0,l(3254).createBrowserClient)("https://enadqzzfyywsbictfwvg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuYWRxenpmeXl3c2JpY3Rmd3ZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxODQ1OTIsImV4cCI6MjA3MTc2MDU5Mn0.VPk2P-BIeJs01QDgUwYtn-K66onMC70WpZeYdHZbEXs")},7217:(e,t,l)=>{"use strict";l.d(t,{$h:()=>m,Ah:()=>r,E2:()=>s,EY:()=>c,Hz:()=>a,IH:()=>p,Nb:()=>i,QP:()=>u,Rs:()=>b,dT:()=>f,lP:()=>o,oS:()=>g,ox:()=>d,sH:()=>v,tX:()=>x,zM:()=>j});var n=l(5155);l(2115);let a=e=>{let{imageUrl:t,onFileSelect:l,onDrop:a,onDragOver:s,onPickClick:r,inputRef:i}=e;return(0,n.jsxs)("div",{className:"border border-dashed rounded-xl h-32 flex items-center justify-center relative hover:border-white/60 transition-colors cursor-pointer group",onClick:r,onDrop:a,onDragOver:s,title:"Click, drag & drop, or paste an image",children:[t?(0,n.jsx)("img",{src:t,alt:"Preview",className:"absolute inset-0 w-full h-full object-cover rounded-xl"}):(0,n.jsxs)("div",{className:"text-center text-white/70 px-4",children:[(0,n.jsx)("div",{className:"text-sm",children:"Image Upload"}),(0,n.jsx)("div",{className:"text-xs mt-1 opacity-80",children:"Click, drag & drop, or paste"})]}),(0,n.jsx)("div",{className:"absolute inset-0 rounded-xl ring-0 group-hover:ring-2 ring-white/10 pointer-events-none"}),(0,n.jsx)("input",{ref:i,type:"file",accept:"image/*",onChange:l,className:"hidden"})]})};async function s(e){let{setEvents:t,setLoadingEvents:l}=e;l(!0);try{var n,a;let e=await fetch("/api/events",{cache:"no-store"}),l=await e.json();if(console.log(l,"fetched data for homepage"),console.log("ANON key fingerprint:",(n="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuYWRxenpmeXl3c2JpY3Rmd3ZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxODQ1OTIsImV4cCI6MjA3MTc2MDU5Mn0.VPk2P-BIeJs01QDgUwYtn-K66onMC70WpZeYdHZbEXs",void 0===n)?void 0:n.slice(0,6),"…",(a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuYWRxenpmeXl3c2JpY3Rmd3ZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxODQ1OTIsImV4cCI6MjA3MTc2MDU5Mn0.VPk2P-BIeJs01QDgUwYtn-K66onMC70WpZeYdHZbEXs",void 0===a)?void 0:a.slice(-6)),!e.ok)throw Error((null==l?void 0:l.error)||"Failed to load events");let s=(l.items||[]).sort((e,t)=>{var l,n;return(null!=(l=e.order)?l:0)-(null!=(n=t.order)?n:0)});t(s)}catch(e){console.error(e)}finally{l(!1)}}async function r(e){let{setEvents:t,setLoadingEvents:l}=e;l(!0);try{let e=await fetch("/api/admin/events",{cache:"no-store"}),l=await e.json();if(!e.ok)throw Error((null==l?void 0:l.error)||"Failed to load events");let n=(l.items||[]).sort((e,t)=>{var l,n;return(null!=(l=e.order)?l:0)-(null!=(n=t.order)?n:0)});t(n)}catch(e){console.error(e)}finally{l(!1)}}async function i(e){let{setSeasons:t,setLoading:l}=e;try{null==l||l(!0);let e=await fetch("/api/seasons",{cache:"no-store"}),n=await e.json();if(!e.ok)throw Error((null==n?void 0:n.error)||"Failed to load seasons");let a=Array.isArray(null==n?void 0:n.items)?n.items:[];return t(a),a}catch(e){return console.error(e),t([]),[]}finally{null==l||l(!1)}}async function o(e){let{setHotspots:t,setLoading:l}=e;try{null==l||l(!0);let e=await fetch("/api/hotspots",{cache:"no-store"}),n=await e.json();if(!e.ok)throw Error((null==n?void 0:n.error)||"Failed to load seasons");let a=Array.isArray(null==n?void 0:n.items)?n.items:[];return t(a),a}catch(e){return console.error(e),t([]),[]}finally{null==l||l(!1)}}function d(e){let{label:t,value:l,onChange:a,placeholder:s}=e;return(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"text-sm mb-1 text-white/80",children:t}),(0,n.jsx)("input",{value:l,onChange:e=>a(e.target.value),placeholder:s,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})}function c(e){let{label:t,value:l,onChange:a,placeholder:s,rows:r=5}=e;return(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"text-sm mb-1 text-white/80",children:t}),(0,n.jsx)("textarea",{value:l,maxLength:500,onChange:e=>a(e.target.value),placeholder:s,rows:r,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30 resize-y"})]})}function u(e){let{label:t,value:l,onChange:a,min:s,max:r}=e;return(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"text-sm mb-1 text-white/80",children:t}),(0,n.jsx)("input",{style:{colorScheme:"dark"},type:"date",value:l,min:s,max:r,onChange:e=>a(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})}let h=["all","live","scheduled","expired","hidden"],m=(e,t,l)=>{if(0===t)return l(!1),null!=e?e:[];{var n;console.log({tabIdx:t}),l(!0);let a=null!=(n=h[t])?n:"live";return console.log({wanted:a}),(null!=e?e:[]).filter(e=>(e=>{if(null==e?void 0:e.computed_status)return e.computed_status;if(!(null==e?void 0:e.published))return"hidden";let t=Date.now(),l=(null==e?void 0:e.publish_at)?new Date(e.publish_at).getTime():null,n=(null==e?void 0:e.unpublish_at)?new Date(e.unpublish_at).getTime():null;return l&&l>t?"scheduled":n&&n<=t?"expired":"live"})(e)===a)}};function p(e){let{publishModal:t,forceOpen:l,startDate:n,endDate:a}=e;if(!t)return!1;if(l)return!0;let s=new Date,r=n?function(e){let t=new Date(e);return t.setHours(0,0,0,0),t}(new Date(n)):new Date(0),i=a?function(e){let t=new Date(e);return t.setHours(23,59,59,999),t}(new Date(a)):new Date(864e13);return s>=r&&s<=i}function x(e,t){if(!e&&!t)return"";if(e&&!t)return w(e);if(!e&&t)return w(t);let l=new Date(e),n=new Date(t);if(isNaN(l.getTime())||isNaN(n.getTime()))return"";if(l.getFullYear()===n.getFullYear()&&l.getMonth()===n.getMonth()){let e=l.toLocaleString(void 0,{month:"short"});return"".concat(e," ").concat(l.getDate(),"–").concat(n.getDate(),", ").concat(l.getFullYear())}return"".concat(w(e)," – ").concat(w(t))}function v(e,t){let l=b(e),n=b(t);return l||n?l&&!n?l:!l&&n?n:"".concat(l," – ").concat(n):""}function b(e,t){var l;let n=function(e){var t,l;if(!(null==e?void 0:e.trim()))return null;let n=/^(\d{1,2})(?::(\d{1,2}))?(?::(\d{1,2})(?:\.\d+)?)?$/.exec(e.trim());if(!n)return null;let a=Number(n[1]),s=Number(null!=(t=n[2])?t:"0"),r=Number(null!=(l=n[3])?l:"0");return Number.isNaN(a)||Number.isNaN(s)||Number.isNaN(r)||a<0||a>23||s<0||s>59||r<0||r>59?null:{h:a,m:s}}(e);if(!n)return"";let a=n.h%12;0===a&&(a=12);let s=n.h<12?"am":"pm",r=(null==t?void 0:t.upper)?s.toUpperCase():s;return"".concat(a,":").concat((l=n.m)<10?"0".concat(l):String(l)," ").concat(r)}function f(e){return e?new Date(e).toISOString():null}let g=e=>{if(!e)return"";let t=new Date(e),l=e=>String(e).padStart(2,"0");return"".concat(t.getFullYear(),"-").concat(l(t.getMonth()+1),"-").concat(l(t.getDate()),"T").concat(l(t.getHours()),":").concat(l(t.getMinutes()))};function w(e){let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}function j(e){return new Promise((t,l)=>{let n=new FileReader;n.onload=()=>t(String(n.result)),n.onerror=l,n.readAsDataURL(e)})}},7857:(e,t,l)=>{"use strict";l.d(t,{A:()=>s});var n=l(7515),a=l(5155);let s=(0,n.A)((0,a.jsx)("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh")},8197:(e,t,l)=>{"use strict";l.d(t,{default:()=>b});var n=l(5155),a=l(2115),s=l(313);function r(e){let{open:t,onClose:l,onCreate:r,pickedAth:i=null,pickedAtv:o=null}=e,[d,c]=(0,a.useState)(""),[u,h]=(0,a.useState)(""),[m,p]=(0,a.useState)(""),[x,v]=(0,a.useState)(""),[b,f]=(0,a.useState)(""),[g,w]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),[y,k]=(0,a.useState)(null),C=(0,a.useRef)(null);(0,a.useEffect)(()=>{t?(null!=i&&v(String(i)),null!=o&&f(String(o))):(c(""),h(""),p(""),v(null!=i?String(i):""),f(null!=o?String(o):""),w(null),N(!1),k(null))},[t,i,o]);let S=(0,a.useMemo)(()=>g?URL.createObjectURL(g):null,[g]);(0,a.useEffect)(()=>()=>{S&&URL.revokeObjectURL(S)},[S]);let I=e=>{let t=e.trim();if(!t)return null;let l=Number(t);return Number.isFinite(l)?l:null};async function D(){try{if(k(null),!d.trim())return void k("Hotspot name is required.");let e=I(x),t=I(b);if(null!=e&&(e<-180||e>180))return void k("ath must be between -180 and 180.");if(null!=t&&(t<-90||t>90))return void k("atv must be between -90 and 90.");N(!0),await r({name:d.trim(),description:u.trim()||null,scene:m.trim()||null,ath:e,atv:t,file:g}),l()}catch(e){k(e instanceof Error?e.message:"Failed to create hotspot.")}finally{N(!1)}}return(0,n.jsxs)(s.lG,{open:t,onClose:j?()=>{}:l,className:"relative z-[2000]",children:[(0,n.jsx)(s.Xi,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm"}),(0,n.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,n.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,n.jsxs)(s.Lj,{className:"w-full max-w-lg rounded-2xl bg-[#212e3f] p-5 text-white shadow-xl ring-1 ring-white/10",children:[(0,n.jsx)(s.L3,{className:"text-lg font-semibold",children:"Add Hotspot"}),(0,n.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Name"}),(0,n.jsx)("input",{type:"text",value:d,onChange:e=>c(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., Lobby",disabled:j})]}),(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Scene (optional)"}),(0,n.jsx)("input",{type:"text",value:m,onChange:e=>p(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., scene_lobby",disabled:j})]}),(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"ath (\xb0)"}),(0,n.jsx)("input",{type:"number",value:x,onChange:e=>v(e.target.value),step:"0.1",min:-180,max:180,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., 0",disabled:j})]}),(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"atv (\xb0)"}),(0,n.jsx)("input",{type:"number",value:b,onChange:e=>f(e.target.value),step:"0.1",min:-90,max:90,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., 0",disabled:j})]})]}),(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Description"}),(0,n.jsx)("textarea",{value:u,onChange:e=>h(e.target.value),rows:3,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"Optional details…",disabled:j})]}),(0,n.jsxs)("div",{className:"rounded-xl border border-dashed border-white/15 bg-[#131a2a] p-3",onDragOver:e=>e.preventDefault(),onDrop:function(e){var t;e.preventDefault();let l=null==(t=e.dataTransfer.files)?void 0:t[0];l&&l.type.startsWith("image/")&&(k(null),w(l))},children:[(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-white/80",children:"Hotspot image (optional)"}),(0,n.jsx)("div",{className:"text-xs text-white/50",children:"PNG/JPG/WEBP/GIF"})]}),(0,n.jsx)("button",{type:"button",onClick:function(){var e;null==(e=C.current)||e.click()},disabled:j,className:"rounded-md bg-white/10 px-3 py-1.5 text-sm hover:bg-white/20 disabled:opacity-50",children:"Browse…"})]}),(0,n.jsx)("input",{ref:C,type:"file",accept:"image/*",onChange:function(e){var t;let l=null==(t=e.target.files)?void 0:t[0];if(l){if(!l.type.startsWith("image/"))return void k("Please select an image (png/jpg/webp/gif).");k(null),w(l)}},className:"hidden"}),S?(0,n.jsx)("div",{className:"mt-3 relative aspect-video w-full overflow-hidden rounded-lg",children:(0,n.jsx)("img",{src:S,alt:"Preview",className:"h-full w-full object-contain bg-black/20"})}):(0,n.jsx)("div",{className:"mt-3 flex h-28 items-center justify-center rounded-lg bg-black/20 text-xs text-white/50",children:"No image selected"})]}),y&&(0,n.jsx)("div",{className:"text-xs text-red-300",children:y}),(0,n.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:l,disabled:j,className:"rounded-lg px-3 py-2 text-sm bg-white/10 hover:bg-white/20 disabled:opacity-50",children:"Cancel"}),(0,n.jsx)("button",{type:"button",onClick:D,disabled:j||!d.trim(),className:"rounded-lg px-3 py-2 text-sm font-medium text-black bg-green-400 hover:bg-green-500 disabled:opacity-50",children:j?"Saving…":"Create"})]})]})]})})})]})}var i=l(7217),o=l(3649),d=l(5381),c=l(9564),u=l(3127),h=l(3114),m=l(7857),p=l(644),x=l(5695);function v(e){var t,l,s,r,i;let{initial:c,hotspotId:u,onSaved:h,onCancel:m,onChange:p}=e,v=(0,x.useRouter)(),b=(0,x.useSearchParams)().get("id")||void 0,f=null!=(t=null!=u?u:null==c?void 0:c.id)?t:b,{profile:g}=(0,d.J)(),[w,j]=(0,a.useState)(!1),[N,y]=(0,a.useState)(null),[k,C]=(0,a.useState)({open:!1,message:"",severity:""}),[S,I]=(0,a.useState)(null!=c?c:{id:"",name:"",description:null,scene:"",ath:null,atv:null,image_url:null}),[D,A]=(0,a.useState)(null),[P,E]=(0,a.useState)(null!=(l=null==c?void 0:c.image_url)?l:null),O=(0,a.useRef)(null);function M(e,t){let l={...S,[e]:t};I(l),null==p||p(l)}(0,a.useEffect)(()=>{c&&I(c)},[c]),(0,a.useEffect)(()=>{!c&&f&&(async()=>{try{var e,t,l,n,a,s,r,i;j(!0),y(null);let o=await fetch("/api/hotspots?limit=1000",{cache:"no-store"}),d=await o.json();if(!o.ok)throw Error((null==d?void 0:d.error)||"Failed to load hotspot");let c=(null!=(e=null==d?void 0:d.items)?e:[]).find(e=>e.id===f);if(!c)throw Error("Hotspot not found");let u={id:c.id,name:null!=(t=c.name)?t:"",description:null!=(l=c.description)?l:null,scene:null!=(n=c.scene)?n:"",ath:null!=(a=c.ath)?a:null,atv:null!=(s=c.atv)?s:null,image_url:null!=(r=c.image_url)?r:null};I(u),E(null!=(i=c.image_url)?i:null),null==p||p(u)}catch(e){y(e instanceof Error?e.message:"Failed to load hotspot")}finally{j(!1)}})()},[f,c,p]);let z=(0,a.useMemo)(()=>D?URL.createObjectURL(D):P,[D,P]);async function J(){if(!f)return void y("Missing hotspot id.");if(!S.name.trim())return void y("Name is required.");j(!0),y(null);try{var e,t,l;let n=new FormData;n.append("name",S.name.trim()),(null==(e=S.scene)?void 0:e.trim())&&n.append("scene",S.scene.trim()),(null==(t=S.description)?void 0:t.trim())&&n.append("description",S.description.trim()),null!=S.ath&&n.append("ath",String(S.ath)),null!=S.atv&&n.append("atv",String(S.atv)),D&&n.append("file",D);let a=await fetch("/api/admin/hotspots/".concat(f),{method:"PATCH",body:n}),s=await a.json().catch(()=>({}));if(!a.ok)throw C(e=>({...e,open:!0,message:"Update Failed",severity:"error"})),Error((null==s?void 0:s.error)||"Update failed");let r=null==s?void 0:s.item;r&&(C(e=>({...e,open:!0,message:"Update Successful",severity:"success"})),E(null!=(l=r.image_url)?l:P));try{v.refresh()}catch(e){}}catch(e){C(e=>({...e,open:!0,message:"Update Failed",severity:"error"})),y(e instanceof Error?e.message:"Update failed")}finally{j(!1)}}return(0,a.useEffect)(()=>()=>{D&&z&&z.startsWith("blob:")&&URL.revokeObjectURL(z)},[D,z]),(0,n.jsxs)("div",{className:"mt-4 space-y-4 text-white",children:[(0,n.jsxs)("div",{className:"grid grid-cols-1 gap-3 ".concat((null==g?void 0:g.role)==="super-admin"&&"md:grid-cols-2"),children:[(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Name"}),(0,n.jsx)("input",{type:"text",value:S.name,onChange:e=>M("name",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., Lobby",disabled:w})]}),(null==g?void 0:g.role)==="super-admin"&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Scene (optional)"}),(0,n.jsx)("input",{type:"text",value:S.scene,onChange:e=>M("scene",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., scene_lobby",disabled:w})]}),(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"ath (\xb0)"}),(0,n.jsx)("input",{type:"number",value:null!=(s=S.ath)?s:0,onChange:e=>M("ath",parseFloat(e.target.value)),step:"0.1",min:-180,max:180,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., 0",disabled:w})]}),(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"atv (\xb0)"}),(0,n.jsx)("input",{type:"number",value:null!=(r=S.atv)?r:0,onChange:e=>M("atv",parseFloat(e.target.value)),step:"0.1",min:-90,max:90,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., 0",disabled:w})]})]})]}),(0,n.jsxs)("label",{className:"block",children:[(0,n.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Description"}),(0,n.jsx)("textarea",{value:null!=(i=S.description)?i:"",onChange:e=>M("description",e.target.value),rows:3,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"Optional details…",disabled:w})]}),(0,n.jsxs)("div",{className:"rounded-xl border border-dashed border-white/15 bg-[#131a2a] p-3",onDragOver:e=>e.preventDefault(),onDrop:function(e){var t;e.preventDefault();let l=null==(t=e.dataTransfer.files)?void 0:t[0];if(l){if(!l.type.startsWith("image/"))return void y("Please select an image file.");y(null),A(l)}},children:[(0,n.jsx)("div",{className:"flex items-center justify-between gap-3",children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-sm text-white/80",children:"Hotspot image (optional)"}),(0,n.jsx)("div",{className:"text-xs text-white/50",children:"PNG / JPG / WEBP / GIF"})]})}),(0,n.jsxs)("div",{className:"mt-3 flex gap-3",children:[(0,n.jsx)("button",{type:"button",onClick:function(){var e;null==(e=O.current)||e.click()},disabled:w,className:"rounded-md bg-white/10 px-3 py-1.5 text-sm hover:bg-white/20 disabled:opacity-50",children:"Browse…"}),P&&!D?(0,n.jsxs)("span",{className:"text-xs text-white/60 truncate",children:["Current: ",P]}):null]}),(0,n.jsx)("input",{ref:O,type:"file",accept:"image/*",onChange:function(e){var t;let l=null==(t=e.target.files)?void 0:t[0];if(l){if(!l.type.startsWith("image/"))return void y("Please select an image file.");y(null),A(l)}},className:"hidden"}),z?(0,n.jsx)("div",{className:"mt-3 relative aspect-video w-full overflow-hidden rounded-lg",children:(0,n.jsx)("img",{src:z,alt:"Preview",className:"h-full w-full object-contain bg-black/20"})}):(0,n.jsx)("div",{className:"mt-3 flex h-28 items-center justify-center rounded-lg bg-black/20 text-xs text-white/50",children:"No image selected"})]}),N&&(0,n.jsx)("div",{className:"text-xs text-red-300",children:N}),(0,n.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,n.jsx)("button",{type:"button",onClick:function(){m?m():v.back()},disabled:w,className:"rounded-lg px-3 py-2 text-sm bg-white/10 hover:bg-white/20 disabled:opacity-50",children:"Cancel"}),(0,n.jsx)("button",{type:"button",onClick:J,disabled:w||!S.name.trim()||!f,className:"rounded-lg px-3 py-2 text-sm font-medium text-black bg-green-400 hover:bg-green-500 disabled:opacity-50",children:w?"Saving…":"Update"})]}),(0,n.jsx)(o.A,{snackbarSettings:k,setSnackbarSettings:C})]})}function b(){let e=(0,a.useRef)(null),[t,l]=(0,a.useState)(!1),[s,x]=(0,a.useState)(null),[b,f]=(0,a.useState)(!1),[g,w]=(0,a.useState)(null),[j,N]=(0,a.useState)(!1),[y,k]=(0,a.useState)(!1),{profile:C}=(0,d.J)(),[S,I]=(0,a.useState)({open:!1,message:"",severity:""}),[D,A]=(0,a.useState)({name:"",description:null,scene:"",ath:null,atv:null,image_url:null,id:""});async function P(e){let t=new FormData;t.append("name",e.name),e.description&&t.append("description",e.description),e.scene&&t.append("scene",e.scene),null!=e.ath&&t.append("ath",String(e.ath)),null!=e.atv&&t.append("atv",String(e.atv)),e.file&&t.append("file",e.file);let l=await fetch("/api/admin/hotspots/create",{method:"POST",body:t}),n=await l.json();if(l.ok)I(e=>({...e,open:!0,message:"Added Hotspot Successfully",severity:"success"}));else throw I(e=>({...e,open:!0,message:"Adding Hotspot Failed",severity:"error"})),Error((null==n?void 0:n.error)||"Create failed")}async function E(){if(!(null==g?void 0:g.id))return void I(e=>({...e,open:!0,message:"Select a hotspot to delete",severity:"error"}));if(window.confirm('Delete hotspot "'.concat(g.name,'"?'))){f(!0);try{let a=await fetch("/api/admin/hotspots/".concat(g.id),{method:"DELETE"}),s=await a.json().catch(()=>({}));if(!a.ok)throw Error((null==s?void 0:s.error)||"Failed to delete hotspot");I(e=>({...e,open:!0,message:"Hotspot deleted",severity:"success"})),await (0,i.lP)({setHotspots:x,setLoading:f}),w(null),N(!1);try{var t,l,n;null==(n=e.current)||null==(l=n.contentWindow)||null==(t=l.location)||t.reload()}catch(e){}}catch(t){let e=t instanceof Error?t.message:"Delete failed";I(t=>({...t,open:!0,message:e,severity:"error"}))}finally{f(!1)}}}(0,a.useEffect)(()=>{(0,i.lP)({setHotspots:x,setLoading:f})},[]),console.log({open:j});let O=!!g&&j;return console.log({isHotspotModalOpen:O}),(0,a.useEffect)(()=>{var e,t,l,n,a,s;g&&A({name:null!=(e=g.name)?e:"",description:null!=(t=g.description)?t:"",scene:null!=(l=g.scene)?l:"",ath:null!=(n=g.ath)?n:0,atv:null!=(a=g.atv)?a:0,image_url:null!=(s=g.image_url)?s:"",id:g.id})},[g]),(0,n.jsxs)("div",{className:"font-sans flex flex-col gap-4 md:flex-row min-h-screen md:h-screen p-8 md:gap-8 sm:px-20 bg-[#151c2f]",children:[(0,n.jsxs)("div",{className:"md:w-[30%] text-white h-[90%] md:overflow-scroll custom-scrollbar shadow-xl rounded-xl bg-[#212e3f] p-3 md:p-5 space-y-4",children:[(null==C?void 0:C.role)==="super-admin"&&(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("button",{onClick:()=>l(!0),className:"bg-green-400 rounded-lg p-2 text-black hover:bg-green-500 hover:cursor-pointer",children:"Add"}),(0,n.jsx)("button",{onClick:E,disabled:!g,className:"bg-red-500 rounded-lg p-2 text-white hover:bg-red-600 hover:cursor-pointer",children:"Delete"})]}),(0,n.jsx)("div",{}),(0,n.jsxs)("div",{className:"flex items-center justify-between px-4",children:[(0,n.jsx)("span",{className:"text-md text-white/60",children:"Ammenities"}),y?(0,n.jsx)(u.A,{size:"small",onClick:()=>{k(!1),w(null)},children:(0,n.jsx)("div",{className:"border border-[rgba(255,255,255,0.1)] flex justify-center items-center p-2 rounded hover:bg-white/10 transition duration-300 ease-in-out",children:(0,n.jsx)(h.A,{htmlColor:"#9ca3af",fontSize:"small"})})}):(0,n.jsx)(u.A,{size:"small",onClick:()=>{(0,i.lP)({setHotspots:x,setLoading:f})},children:(0,n.jsx)(m.A,{className:"text-white/60 hover:cursor-pointer  hover:text-white/80"})}),(0,n.jsx)(r,{open:t,onClose:function(){l(!1)},onCreate:P})]}),!b&&!y&&(0,n.jsx)("ul",{className:"divide-y divide-white/10 rounded-lg h-[150px] md:h-[670px]  overflow-scroll custom-scrollbar",children:null==s?void 0:s.map((e,t)=>(0,n.jsxs)("li",{className:"flex items-center justify-between even:bg-[#151c2f] p-2 px-4  hover:bg-white/10 ".concat((null==g?void 0:g.id)===(null==e?void 0:e.id)&&"bg-white/10 even:bg-white/10"),children:[(0,n.jsx)("span",{onClick:()=>{w(e),N(!0)},className:"text-white hover:cursor-pointer truncate max-w-[70px] md:max-w-[150px]",children:null==e?void 0:e.name}),(0,n.jsx)("span",{children:(0,n.jsx)(u.A,{size:"small",onClick:()=>{w(e),N(!0),k(!0)},children:(0,n.jsx)(p.A,{className:"text-green-400 hover:text-green-500 transition duration-700 ease-in-out"})})})]},null==e?void 0:e.id))}),y&&(0,n.jsx)(v,{hotspotId:null==g?void 0:g.id,onCancel:()=>{k(!1),w(null)},onSaved:()=>{},initial:D,onChange:e=>A(e)})]}),(0,n.jsxs)("div",{className:"md:w-[70%] h-[90%] md:overflow-scroll custom-scrollbar text-white shadow-xl rounded-xl bg-[#212e3f] gap-4 p-3 md:p-5",children:[(0,n.jsx)("div",{className:"mb-2 text-sm text-white/60",children:"Live preview from website"}),(0,n.jsxs)("div",{className:"relative w-full h-[720px] md:h-full border border-white/10 bg-white rounded-xl overflow-hidden",children:[(0,n.jsx)("iframe",{ref:e,src:"/",title:"Website Live Preview",className:"absolute inset-0 object-contain h-full w-full"}),(0,n.jsx)(c.A,{open:O,onClose:()=>{},hotspot:D,container:"contained"})]}),(0,n.jsx)("div",{className:"mt-3 flex justify-between items-center border-t border-white/10 pt-3",children:(0,n.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,n.jsx)("input",{type:"checkbox",checked:j,onChange:e=>N(e.target.checked)}),(0,n.jsx)("span",{children:"Hotspot Modal popup (preview)"})]})})]}),(0,n.jsx)(o.A,{snackbarSettings:S,setSnackbarSettings:I})]})}},9564:(e,t,l)=>{"use strict";l.d(t,{A:()=>i});var n=l(5155),a=l(2115),s=l(6766),r=l(528);function i(e){let{open:t,onClose:l,hotspot:i,container:o="contained"}=e,[d,c]=(0,a.useState)(!1),[u,h]=(0,a.useState)(!1),m=(0,a.useRef)(null);if((0,a.useEffect)(()=>{t||c(!1)},[t]),!i||!t)return null;console.log({hotspot:i});let p="contained"===o?"absolute":"fixed";return(0,n.jsxs)("div",{id:"hotspotModal",className:"".concat(p," inset-0 ").concat("contained"===o?"z-10":"z-[50]"," flex items-center justify-center"),role:"dialog","aria-modal":"true",children:[(0,n.jsx)("div",{className:"".concat(p," inset-0 bg-black/60 backdrop-blur-[1px]"),onClick:l}),(0,n.jsxs)("div",{className:"relative z-10 w-full max-w-[290px] md:max-w-[560px] rounded-2xl bg-white shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("button",{onClick:l,"aria-label":"Close",className:"absolute -right-3 -top-3 flex h-10 w-10 items-center justify-center rounded-full bg-red-500 hover:bg-red-600 text-white shadow-lg cursor-pointer ring-4 ring-white",children:"\xd7"}),(0,n.jsxs)("div",{className:"px-5 pb-5 pt-6",children:[(null==i?void 0:i.image_url)&&(0,n.jsxs)("div",{className:"relative mx-auto mb-4 h-32 w-full overflow-hidden rounded-xl  ".concat("fullscreen"===o?"md:h-60":"md:h-32"),children:[(0,n.jsx)(s.default,{src:i.image_url,alt:i.name||"",fill:!0,unoptimized:!0,className:"object-contain object-center bg-black/50 cursor-zoom-in   hover:scale-[1.02] transition-transform duration-300 hover:opacity-70 hover:duration-500",sizes:"(max-width: 640px) 100vw, 560px",priority:!0,onClick:()=>h(!0)}),(0,n.jsx)(r.B,{open:u,src:i.image_url||"",alt:i.name||"",imageRef:m,onClose:()=>h(!1)})]}),(0,n.jsx)("h2",{className:"text-center text-neutral-600 text-3xl font-semibold tracking-tight whitespace-pre-wrap break-words [overflow-wrap:anywhere] hyphens-auto",children:null==i?void 0:i.name}),!!(null==i?void 0:i.description)&&(0,n.jsx)("div",{className:"mt-4 max-h-56 overflow-y-auto",children:(0,n.jsx)("p",{className:"text-sm leading-relaxed text-neutral-800 whitespace-pre-wrap break-words [overflow-wrap:anywhere] hyphens-auto",children:null==i?void 0:i.description})})]})]})]})}}},e=>{e.O(0,[254,766,19,834,741,694,441,964,358],()=>e(e.s=3970)),_N_E=e.O()}]);