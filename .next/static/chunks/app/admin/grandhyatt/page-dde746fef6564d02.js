(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[747],{2374:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var l in t)Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}(t,{cancelIdleCallback:function(){return a},requestIdleCallback:function(){return l}});let l="undefined"!=typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(e){let t=Date.now();return self.setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},a="undefined"!=typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(e){return clearTimeout(e)};("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2714:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"setAttributesFromProps",{enumerable:!0,get:function(){return n}});let l={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",noModule:"noModule"},a=["onLoad","onReady","dangerouslySetInnerHTML","children","onError","strategy","stylesheets"];function s(e){return["async","defer","noModule"].includes(e)}function n(e,t){for(let[n,r]of Object.entries(t)){if(!t.hasOwnProperty(n)||a.includes(n)||void 0===r)continue;let i=l[n]||n.toLowerCase();"SCRIPT"===e.tagName&&s(i)?e[i]=!!r:e.setAttribute(i,String(r)),(!1===r||"SCRIPT"===e.tagName&&s(i)&&(!r||"false"===r))&&(e.setAttribute(i,""),e.removeAttribute(i))}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3554:(e,t,l)=>{"use strict";l.d(t,{default:()=>s.a});var a=l(9243),s=l.n(a)},3649:(e,t,l)=>{"use strict";l.d(t,{A:()=>i});var a=l(5155),s=l(5726),n=l(2302),r=l(8534);function i(e){let{snackbarSettings:t,setSnackbarSettings:l}=e,{open:i,message:d,severity:o,actionLabel:c,actionCallback:u,duration:h}=t,m=()=>{l(e=>({...e,open:!1,actionLable:null,actionCallback:null}))};return(0,a.jsx)(s.A,{open:i,autoHideDuration:void 0!==h?h:2e3,anchorOrigin:{vertical:"top",horizontal:"center"},onClose:m,children:(0,a.jsx)(n.A,{severity:o,variant:"standard",className:"w-full",onClose:m,action:c&&u?(0,a.jsx)(r.A,{color:"error",size:"small",onClick:()=>{u&&(u(),l(e=>({...e,open:!1})))},children:c}):null,children:d})})}},3970:(e,t,l)=>{Promise.resolve().then(l.bind(l,5433))},5381:(e,t,l)=>{"use strict";l.d(t,{J:()=>d,UserProvider:()=>i});var a=l(5155),s=l(2115),n=l(6414);let r=(0,s.createContext)(void 0);function i(e){let{children:t,initialUser:l=null,initialProfile:i=null}=e,[d,o]=(0,s.useState)(l),[c,u]=(0,s.useState)(i),[h,m]=(0,s.useState)(!l),p=async()=>{m(!0);try{let{data:{user:e}}=await n.N.auth.getUser();if(o(null!=e?e:null),e){let{data:t,error:l}=await n.N.from("profiles").select("id, display_name, role, disabled, created_at").eq("id",e.id).single();l?u(null):u(t)}else u(null)}finally{m(!1)}};(0,s.useEffect)(()=>{l||p();let{data:e}=n.N.auth.onAuthStateChange(async(e,t)=>{var l;if(o(null!=(l=null==t?void 0:t.user)?l:null),null==t?void 0:t.user){let{data:e}=await n.N.from("profiles").select("id, display_name, role, disabled, created_at").eq("id",t.user.id).single();u(null!=e?e:null)}else u(null)});return()=>e.subscription.unsubscribe()},[]);let f=(0,s.useMemo)(()=>{var e,t,l;let a=null!=(t=null==d||null==(e=d.app_metadata)?void 0:e.role)?t:"user";return null!=(l=null==c?void 0:c.role)?l:a},[null==c?void 0:c.role,null==d?void 0:d.app_metadata]),x=(0,s.useMemo)(()=>({user:d,profile:c,role:f,loading:h,refresh:p,signOut:async()=>{await n.N.auth.signOut()}}),[d,c,f,h]);return(0,a.jsx)(r.Provider,{value:x,children:t})}function d(){let e=(0,s.useContext)(r);if(!e)throw Error("useUser must be used within <UserProvider>");return e}},5433:(e,t,l)=>{"use strict";l.d(t,{default:()=>w});var a=l(5155),s=l(2115),n=l(313),r=l(7217);function i(e){let{open:t,onClose:l,onCreate:i}=e,[d,o]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[h,m]=(0,s.useState)(null),[p,f]=(0,s.useState)(!1),[x,v]=(0,s.useState)(null),b=(0,s.useRef)(null),[g,j]=(0,s.useState)(""),[w,y]=(0,s.useState)(""),[N,S]=(0,s.useState)(""),[C,k]=(0,s.useState)(""),[L,_]=(0,s.useState)("");(0,s.useEffect)(()=>{t||(o(""),u(""),m(null),j(""),y(""),S(""),k(""),_(""),f(!1),v(null))},[t]);let P=(0,s.useMemo)(()=>h?URL.createObjectURL(h):null,[h]);async function I(){try{if(v(null),!d.trim())return void v("Hotspot name is required.");f(!0),await i({name:d.trim(),description:c.trim()||null,file:h,level:g||null,startdate:w||null,enddate:N||null,starttime:C||null,endtime:L||null}),l()}catch(e){v(e instanceof Error?e.message:"Failed to create hotspot.")}finally{f(!1)}}return(0,s.useEffect)(()=>()=>{P&&URL.revokeObjectURL(P)},[P]),(0,a.jsxs)(n.lG,{open:t,onClose:p?()=>{}:l,className:"relative z-[2000]",children:[(0,a.jsx)(n.Xi,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm"}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsxs)(n.Lj,{className:"w-full max-w-lg rounded-2xl bg-[#212e3f] p-5 text-white shadow-xl ring-1 ring-white/10",children:[(0,a.jsx)(n.L3,{className:"text-lg font-semibold",children:"Add Hotspot"}),(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Name"}),(0,a.jsx)("input",{type:"text",value:d,onChange:e=>o(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., Lobby",disabled:p})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 w-full text-sm text-white/80",children:"Group"}),(0,a.jsxs)("select",{value:g,onChange:e=>j(e.target.value),disabled:p,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",children:[(0,a.jsx)("option",{value:"",children:"Select Level"}),(0,a.jsx)("option",{value:"Ground Level",children:"Ground Level"}),(0,a.jsx)("option",{value:"Second Level",children:"Second Level"}),(0,a.jsx)("option",{value:"Third Level",children:"Third Level"}),(0,a.jsx)("option",{value:"Fifth Level",children:"Fifth Level"}),(0,a.jsx)("option",{value:"Sixth Level",children:"Sixth Level"}),(0,a.jsx)("option",{value:"60th Level",children:"60th Level"}),(0,a.jsx)("option",{value:"62nd Level",children:"62nd Level"}),(0,a.jsx)("option",{value:"66th Level",children:"66th Level"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)(r.QP,{label:"Start date",value:w,onChange:y}),(0,a.jsx)(r.QP,{label:"End date",value:N,onChange:S,min:w||void 0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 mt-1 gap-2",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"Start time"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"time",value:C,onChange:e=>k(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"End time"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"time",value:L,onChange:e=>_(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Description"}),(0,a.jsx)("textarea",{value:c,onChange:e=>u(e.target.value),rows:3,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"Optional details…",disabled:p})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-dashed border-white/15 bg-[#131a2a] p-3",onDragOver:e=>e.preventDefault(),onDrop:function(e){var t;e.preventDefault();let l=null==(t=e.dataTransfer.files)?void 0:t[0];l&&l.type.startsWith("image/")&&(v(null),m(l))},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-white/80",children:"Hotspot image (optional)"}),(0,a.jsx)("div",{className:"text-xs text-white/50",children:"PNG/JPG/WEBP/GIF"})]}),(0,a.jsx)("button",{type:"button",onClick:function(){var e;null==(e=b.current)||e.click()},disabled:p,className:"rounded-md bg-white/10 px-3 py-1.5 text-sm hover:bg-white/20 disabled:opacity-50",children:"Browse…"})]}),(0,a.jsx)("input",{ref:b,type:"file",accept:"image/*",onChange:function(e){var t;let l=null==(t=e.target.files)?void 0:t[0];if(l){if(!l.type.startsWith("image/"))return void v("Please select an image (png/jpg/webp/gif).");v(null),m(l)}},className:"hidden"}),P?(0,a.jsx)("div",{className:"mt-3 relative aspect-video w-full overflow-hidden rounded-lg",children:(0,a.jsx)("img",{src:P,alt:"Preview",className:"h-full w-full object-contain bg-black/20"})}):(0,a.jsx)("div",{className:"mt-3 flex h-28 items-center justify-center rounded-lg bg-black/20 text-xs text-white/50",children:"No image selected"})]}),x&&(0,a.jsx)("div",{className:"text-xs text-red-300",children:x}),(0,a.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:l,disabled:p,className:"rounded-lg px-3 py-2 text-sm bg-white/10 hover:bg-white/20 disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:I,disabled:p||!d.trim(),className:"rounded-lg px-3 py-2 text-sm font-medium text-black bg-green-400 hover:bg-green-500 disabled:opacity-50",children:p?"Saving…":"Create"})]})]})]})})})]})}var d=l(3649),o=l(5381),c=l(9564),u=l(3127),h=l(3114),m=l(7857),p=l(5695);function f(e){var t,l,n;let{initial:r,hotspotId:i,onSaved:c,onCancel:u,onChange:h}=e,m=(0,p.useRouter)(),f=(0,p.useSearchParams)().get("id")||void 0,x=null!=(t=null!=i?i:null==r?void 0:r.id)?t:f,{profile:v}=(0,o.J)(),[b,g]=(0,s.useState)(!1),[j,w]=(0,s.useState)(null),[y,N]=(0,s.useState)({open:!1,message:"",severity:""}),[S,C]=(0,s.useState)(null!=r?r:{id:"",name:"",description:"",image_url:null,level:"",startdate:"",enddate:"",starttime:"",endtime:""}),[k,L]=(0,s.useState)(null),[_,P]=(0,s.useState)(null!=(l=null==r?void 0:r.image_url)?l:null),I=(0,s.useRef)(null);function E(e,t){let l={...S,[e]:t};C(l),null==h||h(l)}(0,s.useEffect)(()=>{r&&C(r)},[r]),(0,s.useEffect)(()=>{!r&&x&&(async()=>{try{var e,t,l,a,s,n,r,i,d,o;g(!0),w(null);let c=await fetch("/api/hotspots?limit=1000",{cache:"no-store"}),u=await c.json();if(!c.ok)throw Error((null==u?void 0:u.error)||"Failed to load hotspot");let m=(null!=(e=null==u?void 0:u.items)?e:[]).find(e=>e.id===x);if(!m)throw Error("Hotspot not found");let p={id:m.id,name:null!=(t=m.name)?t:"",description:null!=(l=m.description)?l:"",image_url:null!=(a=m.image_url)?a:"",level:null!=(s=m.level)?s:"",startdate:null!=(n=m.startdate)?n:"",enddate:null!=(r=m.enddate)?r:"",starttime:null!=(i=m.starttime)?i:"",endtime:null!=(d=m.endtime)?d:""};C(p),P(null!=(o=m.image_url)?o:null),null==h||h(p)}catch(e){w(e instanceof Error?e.message:"Failed to load hotspot")}finally{g(!1)}})()},[x,r,h]);let O=(0,s.useMemo)(()=>k?URL.createObjectURL(k):_,[k,_]);async function A(){if(!x)return void w("Missing hotspot id.");g(!0),w(null);try{var e,t,l,a,s,n,r,i,d;let o=new FormData;o.append("name",S.name.trim()),o.append("description",null!=(l=null==(e=S.description)?void 0:e.trim())?l:""),o.append("level",null!=(a=null==(t=S.level)?void 0:t.trim())?a:""),o.append("startdate",null!=(s=S.startdate)?s:""),o.append("enddate",null!=(n=S.enddate)?n:""),o.append("starttime",null!=(r=S.starttime)?r:""),o.append("endtime",null!=(i=S.endtime)?i:""),k&&o.append("file",k),console.log("fd",o);let c=await fetch("/api/admin/hotspots/".concat(x),{method:"PATCH",body:o}),u=await c.json().catch(()=>({}));if(!c.ok)throw N(e=>({...e,open:!0,message:"Update Failed",severity:"error"})),Error((null==u?void 0:u.error)||"Update failed");let h=null==u?void 0:u.item;h&&(N(e=>({...e,open:!0,message:"Update Successful",severity:"success"})),P(null!=(d=h.image_url)?d:_));try{m.refresh()}catch(e){}}catch(e){N(e=>({...e,open:!0,message:"Update Failed",severity:"error"})),w(e instanceof Error?e.message:"Update failed")}finally{g(!1)}}return(0,s.useEffect)(()=>()=>{k&&O&&O.startsWith("blob:")&&URL.revokeObjectURL(O)},[k,O]),(0,a.jsxs)("div",{className:"mt-4 space-y-4 text-white",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-3 ".concat((null==v?void 0:v.role)==="super-admin"&&"md:grid-cols-2"),children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Name"}),(0,a.jsx)("input",{type:"text",value:S.name,onChange:e=>E("name",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., Lobby",disabled:b})]}),(null==v?void 0:v.role)==="super-admin"&&(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 w-full text-sm text-white/80",children:"Group"}),(0,a.jsxs)("select",{value:S.level||"",onChange:e=>E("level",e.target.value),disabled:b,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",children:[(0,a.jsx)("option",{value:"",children:"Select Level"}),(0,a.jsx)("option",{value:"Ground Level",children:"Ground Level"}),(0,a.jsx)("option",{value:"Second Level",children:"Second Level"}),(0,a.jsx)("option",{value:"Third Level",children:"Third Level"}),(0,a.jsx)("option",{value:"Fifth Level",children:"Fifth Level"}),(0,a.jsx)("option",{value:"Sixth Level",children:"Sixth Level"}),(0,a.jsx)("option",{value:"60th Level",children:"60th Level"}),(0,a.jsx)("option",{value:"62nd Level",children:"62nd Level"}),(0,a.jsx)("option",{value:"66th Level",children:"66th Level"})]})]})})]}),(0,a.jsxs)("div",{className:"w-full flex flex-col",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"Start date"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"date",value:S.startdate||"",onChange:e=>E("startdate",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"End date"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"date",value:S.enddate||"",onChange:e=>E("enddate",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})]}),(0,a.jsx)("span",{onClick:()=>void(C(e=>({...e,startdate:"",enddate:""})),null==h||h({...S,startdate:"",enddate:""})),className:"w-full text-white/20 cursor-pointer hover:text-white/50 text-end px-2",children:"clear"})]}),(0,a.jsxs)("div",{className:"w-full flex flex-col",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 mt-1 gap-2",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"Start time"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"time",value:S.starttime||"",onChange:e=>E("starttime",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"End time"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"time",value:S.endtime||"",onChange:e=>E("endtime",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})]}),(0,a.jsx)("span",{onClick:()=>void(C(e=>({...e,starttime:"",endtime:""})),null==h||h({...S,starttime:"",endtime:""})),className:"w-full text-white/20 cursor-pointer hover:text-white/50 text-end px-2",children:"clear"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Description"}),(0,a.jsx)("textarea",{value:null!=(n=S.description)?n:"",onChange:e=>E("description",e.target.value),rows:3,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"Optional details…",disabled:b})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-dashed border-white/15 bg-[#131a2a] p-3",onDragOver:e=>e.preventDefault(),onDrop:function(e){var t;e.preventDefault();let l=null==(t=e.dataTransfer.files)?void 0:t[0];if(l){if(!l.type.startsWith("image/"))return void w("Please select an image file.");w(null),L(l)}},children:[(0,a.jsx)("div",{className:"flex items-center justify-between gap-3",children:(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-white/80",children:"Hotspot image (optional)"}),(0,a.jsx)("div",{className:"text-xs text-white/50",children:"PNG / JPG / WEBP / GIF"})]})}),(0,a.jsxs)("div",{className:"mt-3 flex gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:function(){var e;null==(e=I.current)||e.click()},disabled:b,className:"rounded-md bg-white/10 px-3 py-1.5 text-sm hover:bg-white/20 disabled:opacity-50",children:"Browse…"}),_&&!k?(0,a.jsxs)("span",{className:"text-xs text-white/60 truncate",children:["Current: ",_]}):null]}),(0,a.jsx)("input",{ref:I,type:"file",accept:"image/*",onChange:function(e){var t;let l=null==(t=e.target.files)?void 0:t[0];if(l){if(!l.type.startsWith("image/"))return void w("Please select an image file.");w(null),L(l)}},className:"hidden"}),O?(0,a.jsx)("div",{className:"mt-3 relative aspect-video w-full overflow-hidden rounded-lg",children:(0,a.jsx)("img",{src:O,alt:"Preview",className:"h-full w-full object-contain bg-black/20"})}):(0,a.jsx)("div",{className:"mt-3 flex h-28 items-center justify-center rounded-lg bg-black/20 text-xs text-white/50",children:"No image selected"})]}),j&&(0,a.jsx)("div",{className:"text-xs text-red-300",children:j}),(0,a.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:function(){u?u():m.back()},disabled:b,className:"rounded-lg px-3 py-2 text-sm bg-white/10 hover:bg-white/20 disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:A,disabled:b||!x,className:"rounded-lg px-3 py-2 text-sm font-medium text-black bg-green-400 hover:bg-green-500 disabled:opacity-50",children:b?"Saving…":"Update"})]}),(0,a.jsx)(d.A,{snackbarSettings:y,setSnackbarSettings:N})]})}var x=l(644),v=l(5294);let b=(0,l(7515).A)((0,a.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");function g(e){let{title:t,droppableId:l,items:n,selectedHotspot:r,setSelectedHotspot:i,setOpen:d,setShowUpdate:o}=e,[c,h]=(0,s.useState)(!1);return n.length?(0,a.jsxs)("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:[(0,a.jsxs)("div",{onClick:()=>h(e=>!e),className:"flex items-center justify-between px-4 py-2 bg-[#1b2638] cursor-pointer hover:bg-white/10",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-white/70",children:t}),(0,a.jsx)("span",{className:"transition-transform text-white/60 ".concat(c?"rotate-90":"rotate-0"),children:(0,a.jsx)(b,{fontSize:"small"})})]}),(0,a.jsx)(v.gL,{droppableId:l,children:e=>(0,a.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"relative transition-all duration-300 ease-in-out overflow-hidden ".concat(c?"max-h-[500px]":"max-h-0"),children:[n.map((e,t)=>{let l=(null==r?void 0:r.id)===e.id,s=t===n.length-1;return(0,a.jsx)(v.sx,{draggableId:e.id,index:t,children:(t,n)=>{var r;return(0,a.jsxs)("div",{ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,className:"relative flex items-center justify-between pl-10 pr-4 py-2 border-t border-white/10 hover:bg-white/10 ".concat(l?"bg-white/10":""," ").concat(n.isDragging?"bg-white/20":""),children:[(0,a.jsx)("div",{className:"absolute left-6 top-1/2 w-4 border-t border-white/20"}),!s&&(0,a.jsx)("div",{className:"absolute left-6 top-0 bottom-0 border-l border-white/20"}),s&&(0,a.jsx)("div",{className:"absolute left-6 top-0 bottom-1/2 border-l border-white/20"}),(0,a.jsx)("span",{onClick:()=>{i(e),d(!0)},className:"text-white truncate max-w-[150px] md:max-w-[200px] cursor-pointer",children:null!=(r=e.name)?r:e.id}),(0,a.jsx)(u.A,{size:"small",onClick:t=>{t.stopPropagation(),i(e),d(!0),o(!0)},children:(0,a.jsx)(x.A,{className:"text-green-400 hover:text-green-500 transition duration-700 ease-in-out"})})]})}},e.id)}),e.placeholder]})})]}):null}var j=l(4302);function w(){let e=(0,s.useRef)(null),[t,l]=(0,s.useState)(!1),[n,p]=(0,s.useState)(null),[x,b]=(0,s.useState)(!1),[w,y]=(0,s.useState)(null),[N,S]=(0,s.useState)(!1),[C,k]=(0,s.useState)(!1),{profile:L}=(0,o.J)(),[_,P]=(0,s.useState)(!1),[I,E]=(0,s.useState)(!1),[O,A]=(0,s.useState)({open:!1,message:"",severity:""}),[M,R]=(0,s.useState)({name:"",description:null,image_url:null,id:"",level:null,startdate:null,enddate:null,starttime:null,endtime:null});async function T(e){let t=new FormData;t.append("name",e.name),e.description&&t.append("description",e.description),e.file&&t.append("file",e.file),e.level&&t.append("level",e.level),e.startdate&&t.append("startdate",e.startdate),e.enddate&&t.append("enddate",e.enddate),e.starttime&&t.append("starttime",e.starttime),e.endtime&&t.append("endtime",e.endtime);let l=await fetch("/api/admin/hotspots/create",{method:"POST",body:t}),a=await l.json();if(l.ok)A(e=>({...e,open:!0,message:"Added Hotspot Successfully",severity:"success"}));else throw A(e=>({...e,open:!0,message:"Adding Hotspot Failed",severity:"error"})),Error((null==a?void 0:a.error)||"Create failed")}async function D(){if(!(null==w?void 0:w.id))return void A(e=>({...e,open:!0,message:"Select a hotspot to delete",severity:"error"}));if(window.confirm('Delete hotspot "'.concat(w.name,'"?'))){b(!0);try{let s=await fetch("/api/admin/hotspots/".concat(w.id),{method:"DELETE"}),n=await s.json().catch(()=>({}));if(!s.ok)throw Error((null==n?void 0:n.error)||"Failed to delete hotspot");A(e=>({...e,open:!0,message:"Hotspot deleted",severity:"success"})),await (0,r.lP)({setHotspots:p,setLoading:b}),y(null),S(!1);try{var t,l,a;null==(a=e.current)||null==(l=a.contentWindow)||null==(t=l.location)||t.reload()}catch(e){}}catch(t){let e=t instanceof Error?t.message:"Delete failed";A(t=>({...t,open:!0,message:e,severity:"error"}))}finally{b(!1)}}}(0,s.useEffect)(()=>{(0,r.lP)({setHotspots:p,setLoading:b})},[]),console.log({open:N});let F=!!w&&N;async function H(){if(!n||!_)return;E(!0);let e=n.reduce((e,t)=>(e[t.level]||(e[t.level]=[]),e[t.level].push({id:t.id,order:t.order}),e),{});try{if(!(await fetch("/api/admin/hotspots/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grouped:e})})).ok)throw Error("Failed to save order");P(!1),A(e=>({...e,open:!0,message:"Order saved successfully",severity:"success"}))}catch(e){A(t=>({...t,open:!0,message:e instanceof Error?e.message:"Save failed",severity:"error"}))}finally{E(!1)}}return console.log({isHotspotModalOpen:F}),(0,s.useEffect)(()=>{var e,t,l,a,s,n,r,i;w&&R({name:null!=(e=w.name)?e:"",description:null!=(t=w.description)?t:"",image_url:null!=(l=w.image_url)?l:"",id:w.id,level:null!=(a=w.level)?a:"",startdate:null!=(s=w.startdate)?s:"",enddate:null!=(n=w.enddate)?n:"",starttime:null!=(r=w.starttime)?r:"",endtime:null!=(i=w.endtime)?i:""})},[w]),(0,a.jsxs)("div",{className:"font-sans flex flex-col gap-4 md:flex-row min-h-screen md:h-screen p-8 md:gap-8 sm:px-20 bg-[#151c2f]",children:[(0,a.jsxs)("div",{className:"md:w-[30%] text-white h-[90%] md:overflow-scroll custom-scrollbar shadow-xl rounded-xl bg-[#212e3f] p-3 md:p-5 space-y-4",children:[(null==L?void 0:L.role)==="super-admin"&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>l(!0),className:"bg-green-400 rounded-lg p-2 text-black hover:bg-green-500 hover:cursor-pointer",children:"Add"}),(0,a.jsx)("button",{onClick:D,disabled:!w,className:"bg-red-500 rounded-lg p-2 text-white hover:bg-red-600 hover:cursor-pointer",children:"Delete"}),(0,a.jsx)("button",{onClick:H,disabled:I||!_,className:"".concat(I?"bg-gray-400":"bg-blue-500 hover:bg-blue-600"," rounded-lg p-2 text-white transition disabled:opacity-50"),children:I?"Saving…":"Save Order"})]}),(0,a.jsx)("div",{}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-4",children:[(0,a.jsx)("span",{className:"text-md text-white/60",children:"Ammenities"}),C?(0,a.jsx)(u.A,{size:"small",onClick:()=>{k(!1),y(null)},children:(0,a.jsx)("div",{className:"border border-[rgba(255,255,255,0.1)] flex justify-center items-center p-2 rounded hover:bg-white/10 transition duration-300 ease-in-out",children:(0,a.jsx)(h.A,{htmlColor:"#9ca3af",fontSize:"small"})})}):(0,a.jsx)(u.A,{size:"small",onClick:()=>{(0,r.lP)({setHotspots:p,setLoading:b})},children:(0,a.jsx)(m.A,{className:"text-white/60 hover:cursor-pointer  hover:text-white/80"})}),(0,a.jsx)(i,{open:t,onClose:function(){l(!1)},onCreate:T})]}),!x&&!C&&(0,a.jsx)(v.JY,{onDragEnd:function(e){let{source:t,destination:l}=e;if(l){var a,s,n;t.droppableId===l.droppableId&&(a=t.droppableId,s=t.index,n=l.index,p(e=>{if(!e)return e;let t=[...e],l=t.filter(e=>e.level===a),r=l[s];l.splice(s,1),l.splice(n,0,r);let i=l.map((e,t)=>({...e,order:t})),d=[...t.filter(e=>e.level!==a),...i];return P(!0),d}))}},children:(0,a.jsx)("div",{className:"rounded-lg h-[150px] md:h-[670px] overflow-scroll custom-scrollbar space-y-2",children:(()=>{let e={};return null==n||n.forEach(t=>{let l=t.level||"Uncategorized";e[l]||(e[l]=[]),e[l].push(t)}),["Ground Level","Second Level","Third Level","Fifth Level","Sixth Level","60th Level","62nd Level","66th Level"].map(t=>(0,a.jsx)(g,{title:t,droppableId:t,items:e[t]||[],selectedHotspot:w,setSelectedHotspot:y,setOpen:S,setShowUpdate:k},t))})()})}),C&&(0,a.jsx)(f,{hotspotId:null==w?void 0:w.id,onCancel:()=>{k(!1),y(null)},onSaved:()=>{},initial:M,onChange:e=>R(e)})]}),(0,a.jsxs)("div",{className:"md:w-[70%] h-[90%] md:overflow-scroll custom-scrollbar text-white shadow-xl rounded-xl bg-[#212e3f] gap-4 p-3 md:p-5",children:[(0,a.jsxs)("div",{className:"mb-2 text-sm text-white/60 w-full flex gap-x-2",children:[(0,a.jsx)(m.A,{fontSize:"small",className:"text-white/60 hover:cursor-pointer  hover:text-white/80"}),(0,a.jsx)("span",{children:"Live preview from website"})]}),(0,a.jsxs)("div",{className:"relative w-full h-[720px] md:h-full border border-white/10 bg-white rounded-xl overflow-hidden",children:[(0,a.jsx)(j.A,{xml:"/vtour/tour.xml",container:"contained"}),(0,a.jsx)(c.A,{open:F,onClose:()=>{},hotspot:M,container:"contained"})]}),(0,a.jsx)("div",{className:"mt-3 flex justify-between items-center border-t border-white/10 pt-3",children:(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:N,onChange:e=>S(e.target.checked)}),(0,a.jsx)("span",{children:"Hotspot Modal popup (preview)"})]})})]}),(0,a.jsx)(d.A,{snackbarSettings:O,setSnackbarSettings:A})]})}},5695:(e,t,l)=>{"use strict";var a=l(8999);l.o(a,"usePathname")&&l.d(t,{usePathname:function(){return a.usePathname}}),l.o(a,"useRouter")&&l.d(t,{useRouter:function(){return a.useRouter}}),l.o(a,"useSearchParams")&&l.d(t,{useSearchParams:function(){return a.useSearchParams}})},6414:(e,t,l)=>{"use strict";l.d(t,{N:()=>a});let a=(0,l(3254).createBrowserClient)("https://enadqzzfyywsbictfwvg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuYWRxenpmeXl3c2JpY3Rmd3ZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxODQ1OTIsImV4cCI6MjA3MTc2MDU5Mn0.VPk2P-BIeJs01QDgUwYtn-K66onMC70WpZeYdHZbEXs")},9243:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var l in t)Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}(t,{default:function(){return v},handleClientScriptLoad:function(){return p},initScriptLoader:function(){return f}});let a=l(8466),s=l(3011),n=l(5155),r=a._(l(7650)),i=s._(l(2115)),d=l(2830),o=l(2714),c=l(2374),u=new Map,h=new Set,m=e=>{let{src:t,id:l,onLoad:a=()=>{},onReady:s=null,dangerouslySetInnerHTML:n,children:i="",strategy:d="afterInteractive",onError:c,stylesheets:m}=e,p=l||t;if(p&&h.has(p))return;if(u.has(t)){h.add(p),u.get(t).then(a,c);return}let f=()=>{s&&s(),h.add(p)},x=document.createElement("script"),v=new Promise((e,t)=>{x.addEventListener("load",function(t){e(),a&&a.call(this,t),f()}),x.addEventListener("error",function(e){t(e)})}).catch(function(e){c&&c(e)});n?(x.innerHTML=n.__html||"",f()):i?(x.textContent="string"==typeof i?i:Array.isArray(i)?i.join(""):"",f()):t&&(x.src=t,u.set(t,v)),(0,o.setAttributesFromProps)(x,e),"worker"===d&&x.setAttribute("type","text/partytown"),x.setAttribute("data-nscript",d),m&&(e=>{if(r.default.preinit)return e.forEach(e=>{r.default.preinit(e,{as:"style"})});{let t=document.head;e.forEach(e=>{let l=document.createElement("link");l.type="text/css",l.rel="stylesheet",l.href=e,t.appendChild(l)})}})(m),document.body.appendChild(x)};function p(e){let{strategy:t="afterInteractive"}=e;"lazyOnload"===t?window.addEventListener("load",()=>{(0,c.requestIdleCallback)(()=>m(e))}):m(e)}function f(e){e.forEach(p),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(e=>{let t=e.id||e.getAttribute("src");h.add(t)})}function x(e){let{id:t,src:l="",onLoad:a=()=>{},onReady:s=null,strategy:o="afterInteractive",onError:u,stylesheets:p,...f}=e,{updateScripts:x,scripts:v,getIsSsr:b,appDir:g,nonce:j}=(0,i.useContext)(d.HeadManagerContext);j=f.nonce||j;let w=(0,i.useRef)(!1);(0,i.useEffect)(()=>{let e=t||l;w.current||(s&&e&&h.has(e)&&s(),w.current=!0)},[s,t,l]);let y=(0,i.useRef)(!1);if((0,i.useEffect)(()=>{if(!y.current){if("afterInteractive"===o)m(e);else"lazyOnload"===o&&("complete"===document.readyState?(0,c.requestIdleCallback)(()=>m(e)):window.addEventListener("load",()=>{(0,c.requestIdleCallback)(()=>m(e))}));y.current=!0}},[e,o]),("beforeInteractive"===o||"worker"===o)&&(x?(v[o]=(v[o]||[]).concat([{id:t,src:l,onLoad:a,onReady:s,onError:u,...f,nonce:j}]),x(v)):b&&b()?h.add(t||l):b&&!b()&&m({...e,nonce:j})),g){if(p&&p.forEach(e=>{r.default.preinit(e,{as:"style"})}),"beforeInteractive"===o)if(!l)return f.dangerouslySetInnerHTML&&(f.children=f.dangerouslySetInnerHTML.__html,delete f.dangerouslySetInnerHTML),(0,n.jsx)("script",{nonce:j,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([0,{...f,id:t}])+")"}});else return r.default.preload(l,f.integrity?{as:"script",integrity:f.integrity,nonce:j,crossOrigin:f.crossOrigin}:{as:"script",nonce:j,crossOrigin:f.crossOrigin}),(0,n.jsx)("script",{nonce:j,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([l,{...f,id:t}])+")"}});"afterInteractive"===o&&l&&r.default.preload(l,f.integrity?{as:"script",integrity:f.integrity,nonce:j,crossOrigin:f.crossOrigin}:{as:"script",nonce:j,crossOrigin:f.crossOrigin})}return null}Object.defineProperty(x,"__nextScript",{value:!0});let v=x;("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}},e=>{e.O(0,[1309,3254,6766,8019,4834,4033,313,8406,1921,8441,5964,7358],()=>e(e.s=3970)),_N_E=e.O()}]);