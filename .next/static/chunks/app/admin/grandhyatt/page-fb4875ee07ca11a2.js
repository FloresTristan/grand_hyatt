(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[747],{2374:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var l in t)Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}(t,{cancelIdleCallback:function(){return a},requestIdleCallback:function(){return l}});let l="undefined"!=typeof self&&self.requestIdleCallback&&self.requestIdleCallback.bind(window)||function(e){let t=Date.now();return self.setTimeout(function(){e({didTimeout:!1,timeRemaining:function(){return Math.max(0,50-(Date.now()-t))}})},1)},a="undefined"!=typeof self&&self.cancelIdleCallback&&self.cancelIdleCallback.bind(window)||function(e){return clearTimeout(e)};("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},2714:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"setAttributesFromProps",{enumerable:!0,get:function(){return n}});let l={acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv",noModule:"noModule"},a=["onLoad","onReady","dangerouslySetInnerHTML","children","onError","strategy","stylesheets"];function s(e){return["async","defer","noModule"].includes(e)}function n(e,t){for(let[n,r]of Object.entries(t)){if(!t.hasOwnProperty(n)||a.includes(n)||void 0===r)continue;let i=l[n]||n.toLowerCase();"SCRIPT"===e.tagName&&s(i)?e[i]=!!r:e.setAttribute(i,String(r)),(!1===r||"SCRIPT"===e.tagName&&s(i)&&(!r||"false"===r))&&(e.setAttribute(i,""),e.removeAttribute(i))}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},3554:(e,t,l)=>{"use strict";l.d(t,{default:()=>s.a});var a=l(9243),s=l.n(a)},3649:(e,t,l)=>{"use strict";l.d(t,{A:()=>i});var a=l(5155),s=l(5726),n=l(2302),r=l(8534);function i(e){let{snackbarSettings:t,setSnackbarSettings:l}=e,{open:i,message:d,severity:o,actionLabel:c,actionCallback:u,duration:h}=t,m=()=>{l(e=>({...e,open:!1,actionLable:null,actionCallback:null}))};return(0,a.jsx)(s.A,{open:i,autoHideDuration:void 0!==h?h:2e3,anchorOrigin:{vertical:"top",horizontal:"center"},onClose:m,children:(0,a.jsx)(n.A,{severity:o,variant:"standard",className:"w-full",onClose:m,action:c&&u?(0,a.jsx)(r.A,{color:"error",size:"small",onClick:()=>{u&&(u(),l(e=>({...e,open:!1})))},children:c}):null,children:d})})}},3970:(e,t,l)=>{Promise.resolve().then(l.bind(l,5433))},5381:(e,t,l)=>{"use strict";l.d(t,{J:()=>d,UserProvider:()=>i});var a=l(5155),s=l(2115),n=l(6414);let r=(0,s.createContext)(void 0);function i(e){let{children:t,initialUser:l=null,initialProfile:i=null}=e,[d,o]=(0,s.useState)(l),[c,u]=(0,s.useState)(i),[h,m]=(0,s.useState)(!l),p=async()=>{m(!0);try{let{data:{user:e}}=await n.N.auth.getUser();if(o(null!=e?e:null),e){let{data:t,error:l}=await n.N.from("profiles").select("id, display_name, role, disabled, created_at").eq("id",e.id).single();l?u(null):u(t)}else u(null)}finally{m(!1)}};(0,s.useEffect)(()=>{l||p();let{data:e}=n.N.auth.onAuthStateChange(async(e,t)=>{var l;if(o(null!=(l=null==t?void 0:t.user)?l:null),null==t?void 0:t.user){let{data:e}=await n.N.from("profiles").select("id, display_name, role, disabled, created_at").eq("id",t.user.id).single();u(null!=e?e:null)}else u(null)});return()=>e.subscription.unsubscribe()},[]);let f=(0,s.useMemo)(()=>{var e,t,l;let a=null!=(t=null==d||null==(e=d.app_metadata)?void 0:e.role)?t:"user";return null!=(l=null==c?void 0:c.role)?l:a},[null==c?void 0:c.role,null==d?void 0:d.app_metadata]),x=(0,s.useMemo)(()=>({user:d,profile:c,role:f,loading:h,refresh:p,signOut:async()=>{await n.N.auth.signOut()}}),[d,c,f,h]);return(0,a.jsx)(r.Provider,{value:x,children:t})}function d(){let e=(0,s.useContext)(r);if(!e)throw Error("useUser must be used within <UserProvider>");return e}},5433:(e,t,l)=>{"use strict";l.d(t,{default:()=>j});var a=l(5155),s=l(2115),n=l(313),r=l(7217);function i(e){let{open:t,onClose:l,onCreate:i}=e,[d,o]=(0,s.useState)(""),[c,u]=(0,s.useState)(""),[h,m]=(0,s.useState)(null),[p,f]=(0,s.useState)(!1),[x,b]=(0,s.useState)(null),v=(0,s.useRef)(null),[g,w]=(0,s.useState)(""),[j,y]=(0,s.useState)(""),[N,S]=(0,s.useState)(""),[_,C]=(0,s.useState)(""),[k,L]=(0,s.useState)(""),[I,O]=(0,s.useState)(""),[P,E]=(0,s.useState)(""),[A,M]=(0,s.useState)("");(0,s.useEffect)(()=>{t||(o(""),u(""),m(null),w(""),y(""),S(""),C(""),L(""),O(""),M(""),E(""),f(!1),b(null))},[t]);let T=(0,s.useMemo)(()=>h?URL.createObjectURL(h):null,[h]);async function R(){try{if(b(null),!d.trim())return void b("Hotspot name is required.");f(!0),await i({name:d.trim(),description:c.trim()||null,file:h,level:g||null,startdate:j||null,enddate:N||null,starttime:_||null,endtime:k||null,title:I||null,cta_label:P||null,cta_href:A||null}),l()}catch(e){b(e instanceof Error?e.message:"Failed to create hotspot.")}finally{f(!1)}}return(0,s.useEffect)(()=>()=>{T&&URL.revokeObjectURL(T)},[T]),(0,a.jsxs)(n.lG,{open:t,onClose:p?()=>{}:l,className:"relative z-[2000]",children:[(0,a.jsx)(n.Xi,{className:"fixed inset-0 bg-black/60 backdrop-blur-sm"}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsxs)(n.Lj,{className:"w-full max-w-lg rounded-2xl bg-[#212e3f] p-5 text-white shadow-xl ring-1 ring-white/10",children:[(0,a.jsx)(n.L3,{className:"text-lg font-semibold",children:"Add Hotspot"}),(0,a.jsxs)("div",{className:"mt-4 space-y-4",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Ammenity"}),(0,a.jsx)("input",{type:"text",value:d,onChange:e=>o(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., Lobby",disabled:p})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 w-full text-sm text-white/80",children:"Group"}),(0,a.jsxs)("select",{value:g,onChange:e=>w(e.target.value),disabled:p,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",children:[(0,a.jsx)("option",{value:"",children:"Select Level"}),(0,a.jsx)("option",{value:"Ground Level",children:"Ground Level"}),(0,a.jsx)("option",{value:"Second Level",children:"Second Level"}),(0,a.jsx)("option",{value:"Third Level",children:"Third Level"}),(0,a.jsx)("option",{value:"Fifth Level",children:"Fifth Level"}),(0,a.jsx)("option",{value:"Sixth Level",children:"Sixth Level"}),(0,a.jsx)("option",{value:"60th Level",children:"60th Level"}),(0,a.jsx)("option",{value:"62nd Level",children:"62nd Level"}),(0,a.jsx)("option",{value:"66th Level",children:"66th Level"})]})]})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Title"}),(0,a.jsx)("input",{type:"text",value:I,onChange:e=>O(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., Lobby",disabled:p})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsx)(r.QP,{label:"Start date",value:j,onChange:y}),(0,a.jsx)(r.QP,{label:"End date",value:N,onChange:S,min:j||void 0})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 mt-1 gap-2",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"Start time"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"time",value:_,onChange:e=>C(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"End time"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"time",value:k,onChange:e=>L(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 mt-1 gap-2",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"CTA Label"}),(0,a.jsx)("input",{value:P||"",onChange:()=>{},placeholder:"Learn More",className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"CTA Link"}),(0,a.jsx)("input",{value:A||"",onChange:()=>{},placeholder:"https://example.com",className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Description"}),(0,a.jsx)("textarea",{value:c,onChange:e=>u(e.target.value),rows:3,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"Optional detailsâ€¦",disabled:p})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-dashed border-white/15 bg-[#131a2a] p-3",onDragOver:e=>e.preventDefault(),onDrop:function(e){var t;e.preventDefault();let l=null==(t=e.dataTransfer.files)?void 0:t[0];l&&l.type.startsWith("image/")&&(b(null),m(l))},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-white/80",children:"Hotspot image (optional)"}),(0,a.jsx)("div",{className:"text-xs text-white/50",children:"PNG/JPG/WEBP/GIF"})]}),(0,a.jsx)("button",{type:"button",onClick:function(){var e;null==(e=v.current)||e.click()},disabled:p,className:"rounded-md bg-white/10 px-3 py-1.5 text-sm hover:bg-white/20 disabled:opacity-50",children:"Browseâ€¦"})]}),(0,a.jsx)("input",{ref:v,type:"file",accept:"image/*",onChange:function(e){var t;let l=null==(t=e.target.files)?void 0:t[0];if(l){if(!l.type.startsWith("image/"))return void b("Please select an image (png/jpg/webp/gif).");b(null),m(l)}},className:"hidden"}),T?(0,a.jsx)("div",{className:"mt-3 relative aspect-video w-full overflow-hidden rounded-lg",children:(0,a.jsx)("img",{src:T,alt:"Preview",className:"h-full w-full object-contain bg-black/20"})}):(0,a.jsx)("div",{className:"mt-3 flex h-28 items-center justify-center rounded-lg bg-black/20 text-xs text-white/50",children:"No image selected"})]}),x&&(0,a.jsx)("div",{className:"text-xs text-red-300",children:x}),(0,a.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:l,disabled:p,className:"rounded-lg px-3 py-2 text-sm bg-white/10 hover:bg-white/20 disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:R,disabled:p||!d.trim(),className:"rounded-lg px-3 py-2 text-sm font-medium text-black bg-green-400 hover:bg-green-500 disabled:opacity-50",children:p?"Savingâ€¦":"Create"})]})]})]})})})]})}var d=l(3649),o=l(5381),c=l(9564),u=l(3127),h=l(3114),m=l(7857),p=l(5695);function f(e){var t,l,n,r;let{initial:i,hotspotId:c,onSaved:u,onCancel:h,onChange:m}=e,f=(0,p.useRouter)(),x=(0,p.useSearchParams)().get("id")||void 0,b=null!=(t=null!=c?c:null==i?void 0:i.id)?t:x,{profile:v}=(0,o.J)(),[g,w]=(0,s.useState)(!1),[j,y]=(0,s.useState)(null),[N,S]=(0,s.useState)({open:!1,message:"",severity:""}),[_,C]=(0,s.useState)(null!=i?i:{id:"",name:"",description:"",image_url:null,level:"",startdate:"",enddate:"",starttime:"",endtime:"",title:"",cta_label:"",cta_href:""}),[k,L]=(0,s.useState)(null),[I,O]=(0,s.useState)(null),P=(0,s.useRef)(null);function E(e,t){let l={..._,[e]:t};C(l),null==m||m(l)}(0,s.useEffect)(()=>{i&&(C(i),O(i.image_url))},[i]),(0,s.useEffect)(()=>{console.log("\uD83D\uDD04 Rerender:",{file:k,currentImageUrl:I})},[k,I]),(0,s.useEffect)(()=>{!i&&b&&(async()=>{try{var e,t,l,a,s,n,r,i,d,o,c,u,h;w(!0),y(null);let p=await fetch("/api/hotspots?limit=1000",{cache:"no-store"}),f=await p.json();if(!p.ok)throw Error((null==f?void 0:f.error)||"Failed to load hotspot");let x=(null!=(e=null==f?void 0:f.items)?e:[]).find(e=>e.id===b);if(!x)throw Error("Hotspot not found");let v={id:x.id,name:null!=(t=x.name)?t:"",description:null!=(l=x.description)?l:"",image_url:null!=(a=x.image_url)?a:"",level:null!=(s=x.level)?s:"",startdate:null!=(n=x.startdate)?n:"",enddate:null!=(r=x.enddate)?r:"",starttime:null!=(i=x.starttime)?i:"",endtime:null!=(d=x.endtime)?d:"",title:null!=(o=x.title)?o:"",cta_label:null!=(c=x.cta_label)?c:"",cta_href:null!=(u=x.cta_href)?u:""};C(v),O(null!=(h=x.image_url)?h:null),null==m||m(v)}catch(e){y(e instanceof Error?e.message:"Failed to load hotspot")}finally{w(!1)}})()},[b,i,m]);let A=(0,s.useMemo)(()=>k?URL.createObjectURL(k):I,[k,I]);async function M(){if(!b)return void y("Missing hotspot id.");w(!0),y(null);try{var e,t,l,a,s,n,r,i,d,o,c,u;let h=new FormData;h.append("name",_.name.trim()),h.append("description",null!=(l=null==(e=_.description)?void 0:e.trim())?l:""),h.append("level",null!=(a=null==(t=_.level)?void 0:t.trim())?a:""),h.append("startdate",null!=(s=_.startdate)?s:""),h.append("enddate",null!=(n=_.enddate)?n:""),h.append("starttime",null!=(r=_.starttime)?r:""),h.append("endtime",null!=(i=_.endtime)?i:""),h.append("title",null!=(d=_.title)?d:""),h.append("cta_label",null!=(o=_.cta_label)?o:""),h.append("cta_href",null!=(c=_.cta_href)?c:""),k?(console.log("file",k),h.append("file",k)):k||I||h.append("clearImage","true"),console.log("fd",h);let m=await fetch("/api/admin/hotspots/".concat(b),{method:"PATCH",body:h}),p=await m.json().catch(()=>({}));if(!m.ok)throw S(e=>({...e,open:!0,message:"Update Failed",severity:"error"})),Error((null==p?void 0:p.error)||"Update failed");console.log({data:p});let x=null==p?void 0:p.item;x&&(S(e=>({...e,open:!0,message:"Update Successful",severity:"success"})),O(null!=(u=x.image_url)?u:I));try{f.refresh()}catch(e){}}catch(e){S(e=>({...e,open:!0,message:"Update Failed",severity:"error"})),y(e instanceof Error?e.message:"Update failed")}finally{w(!1)}}return(0,s.useEffect)(()=>()=>{k&&A&&A.startsWith("blob:")&&URL.revokeObjectURL(A)},[k,A]),console.log("file",k),(0,a.jsxs)("div",{className:"mt-4 space-y-4 text-white",children:[(0,a.jsx)("div",{className:"grid grid-cols-1 gap-3 ".concat((null==v?void 0:v.role)==="super-admin"&&"md:grid-cols-2"),children:(null==v?void 0:v.role)==="super-admin"&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Name"}),(0,a.jsx)("input",{type:"text",value:null!=(l=_.name)?l:"",onChange:e=>E("name",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., Lobby",disabled:g})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 w-full text-sm text-white/80",children:"Group"}),(0,a.jsxs)("select",{value:_.level||"",onChange:e=>E("level",e.target.value),disabled:g,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",children:[(0,a.jsx)("option",{value:"",children:"Select Level"}),(0,a.jsx)("option",{value:"Ground Level",children:"Ground Level"}),(0,a.jsx)("option",{value:"Second Level",children:"Second Level"}),(0,a.jsx)("option",{value:"Third Level",children:"Third Level"}),(0,a.jsx)("option",{value:"Fifth Level",children:"Fifth Level"}),(0,a.jsx)("option",{value:"Sixth Level",children:"Sixth Level"}),(0,a.jsx)("option",{value:"60th Level",children:"60th Level"}),(0,a.jsx)("option",{value:"62nd Level",children:"62nd Level"}),(0,a.jsx)("option",{value:"66th Level",children:"66th Level"})]})]})]})}),(0,a.jsx)("div",{className:"w-full ",children:(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 w-full text-sm text-white/80",children:"Title"}),(0,a.jsx)("input",{type:"text",value:null!=(n=_.title)?n:"",onChange:e=>E("title",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"e.g., Lobby",disabled:g})]})}),(0,a.jsxs)("div",{className:"w-full flex flex-col",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"Start date"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"date",value:_.startdate||"",onChange:e=>E("startdate",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"End date"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"date",value:_.enddate||"",onChange:e=>E("enddate",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})]}),(0,a.jsx)("span",{onClick:()=>void(C(e=>({...e,startdate:"",enddate:""})),null==m||m({..._,startdate:"",enddate:""})),className:"w-full text-white/20 cursor-pointer hover:text-white/50 text-end px-2",children:"clear"})]}),(0,a.jsxs)("div",{className:"w-full flex flex-col",children:[(0,a.jsxs)("div",{className:"grid grid-cols-2 mt-1 gap-2",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"Start time"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"time",value:_.starttime||"",onChange:e=>E("starttime",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"End time"}),(0,a.jsx)("input",{style:{colorScheme:"dark"},type:"time",value:_.endtime||"",onChange:e=>E("endtime",e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})]}),(0,a.jsx)("span",{onClick:()=>void(C(e=>({...e,starttime:"",endtime:""})),null==m||m({..._,starttime:"",endtime:""})),className:"w-full text-white/20 cursor-pointer hover:text-white/50 text-end px-2",children:"clear"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-sm text-white/80",children:"Description"}),(0,a.jsx)("textarea",{value:null!=(r=_.description)?r:"",onChange:e=>E("description",e.target.value),rows:3,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30",placeholder:"Optional detailsâ€¦",disabled:g})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 mt-1 gap-2",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"CTA Label"}),(0,a.jsx)("input",{value:_.cta_label||"",onChange:e=>{E("cta_label",e.target.value)},placeholder:"Learn More",className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"CTA Link"}),(0,a.jsx)("input",{value:_.cta_href||"",onChange:e=>{E("cta_href",e.target.value)},placeholder:"https://example.com",className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})]}),(0,a.jsxs)("div",{className:"rounded-xl border border-dashed border-white/15 bg-[#131a2a] p-3",onDragOver:e=>e.preventDefault(),onDrop:function(e){var t;e.preventDefault();let l=null==(t=e.dataTransfer.files)?void 0:t[0];if(l){if(!l.type.startsWith("image/"))return void y("Please select an image file.");y(null),L(l),O(URL.createObjectURL(l))}},children:[(0,a.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"text-sm text-white/80",children:"Hotspot image (optional)"}),(0,a.jsx)("div",{className:"text-xs text-white/50",children:"PNG / JPG / WEBP / GIF"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("span",{onClick:()=>void(C(e=>({...e,image_url:""})),L(null),O(null),P.current&&(P.current.value=""),null==m||m({..._,image_url:""})),className:"text-white/20 cursor-pointer hover:text-white/50 px-2",children:"clear"})})]}),(0,a.jsxs)("div",{className:"mt-3 flex gap-3",children:[(0,a.jsx)("button",{type:"button",onClick:function(){var e;null==(e=P.current)||e.click()},disabled:g,className:"rounded-md bg-white/10 px-3 py-1.5 text-sm hover:bg-white/20 disabled:opacity-50",children:"Browseâ€¦"}),I&&!k?(0,a.jsxs)("span",{className:"text-xs text-white/60 truncate",children:["Current: ",I]}):null]}),(0,a.jsx)("input",{ref:P,type:"file",accept:"image/*",onChange:function(e){var t;let l=null==(t=e.target.files)?void 0:t[0];if(l){if(!l.type.startsWith("image/"))return void y("Please select an image file.");y(null),L(l),O(URL.createObjectURL(l)),C(e=>({...e,image_url:I}))}},className:"hidden"}),A?(0,a.jsx)("div",{className:"mt-3 relative aspect-video w-full overflow-hidden rounded-lg",children:(0,a.jsx)("img",{src:A,alt:"Preview",className:"h-full w-full object-contain bg-black/20"})}):(0,a.jsx)("div",{className:"mt-3 flex h-28 items-center justify-center rounded-lg bg-black/20 text-xs text-white/50",children:"No image selected"})]}),j&&(0,a.jsx)("div",{className:"text-xs text-red-300",children:j}),(0,a.jsxs)("div",{className:"mt-2 flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:function(){h?h():f.back()},disabled:g,className:"rounded-lg px-3 py-2 text-sm bg-white/10 hover:bg-white/20 disabled:opacity-50",children:"Cancel"}),(0,a.jsx)("button",{type:"button",onClick:M,disabled:g||!b,className:"rounded-lg px-3 py-2 text-sm font-medium text-black bg-green-400 hover:bg-green-500 disabled:opacity-50",children:g?"Savingâ€¦":"Update"})]}),(0,a.jsx)(d.A,{snackbarSettings:N,setSnackbarSettings:S})]})}var x=l(644),b=l(5294);let v=(0,l(7515).A)((0,a.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");function g(e){let{title:t,droppableId:l,items:n,selectedHotspot:r,setSelectedHotspot:i,setOpen:d,setShowUpdate:o}=e,[c,h]=(0,s.useState)(!1);return n.length?(console.log({selectedHotspot:r}),(0,a.jsxs)("div",{className:"border border-white/10 rounded-lg overflow-hidden",children:[(0,a.jsxs)("div",{onClick:()=>h(e=>!e),className:"flex items-center justify-between px-4 py-2 bg-[#1b2638] cursor-pointer hover:bg-white/10",children:[(0,a.jsx)("span",{className:"text-sm font-semibold text-white/70",children:t}),(0,a.jsx)("span",{className:"transition-transform text-white/60 ".concat(c?"rotate-90":"rotate-0"),children:(0,a.jsx)(v,{fontSize:"small"})})]}),(0,a.jsx)(b.gL,{droppableId:l,children:e=>(0,a.jsxs)("div",{...e.droppableProps,ref:e.innerRef,className:"relative transition-all duration-300 ease-in-out overflow-hidden ".concat(c?"max-h-[500px]":"max-h-0"),children:[n.map((e,t)=>{let l=(null==r?void 0:r.id)===e.id,s=t===n.length-1;return(0,a.jsx)(b.sx,{draggableId:e.id,index:t,children:(t,n)=>{var r;return(0,a.jsxs)("div",{ref:t.innerRef,...t.draggableProps,...t.dragHandleProps,className:"relative flex items-center justify-between pl-10 pr-4 py-2 border-t border-white/10 hover:bg-white/10 ".concat(l?"bg-white/10":""," ").concat(n.isDragging?"bg-white/20":""),children:[(0,a.jsx)("div",{className:"absolute left-6 top-1/2 w-4 border-t border-white/20"}),!s&&(0,a.jsx)("div",{className:"absolute left-6 top-0 bottom-0 border-l border-white/20"}),s&&(0,a.jsx)("div",{className:"absolute left-6 top-0 bottom-1/2 border-l border-white/20"}),(0,a.jsx)("span",{onClick:()=>{i(e),d(!0)},className:"text-white truncate max-w-[150px] md:max-w-[200px] cursor-pointer",children:null!=(r=e.name)?r:e.id}),(0,a.jsx)(u.A,{size:"small",onClick:t=>{t.stopPropagation(),i(e),d(!0),o(!0)},children:(0,a.jsx)(x.A,{className:"text-green-400 hover:text-green-500 transition duration-700 ease-in-out"})})]})}},e.id)}),e.placeholder]})})]})):null}var w=l(4302);function j(){var e;let t=(0,s.useRef)(null),[l,n]=(0,s.useState)(!1),[p,x]=(0,s.useState)(null),[v,j]=(0,s.useState)(!1),[y,N]=(0,s.useState)(null),[S,_]=(0,s.useState)(!1),[C,k]=(0,s.useState)(!1),{profile:L}=(0,o.J)(),[I,O]=(0,s.useState)(!1),[P,E]=(0,s.useState)(!1),[A,M]=(0,s.useState)({open:!1,message:"",severity:""}),[T,R]=(0,s.useState)({name:"",description:null,image_url:null,id:"",level:null,startdate:null,enddate:null,starttime:null,endtime:null,title:null,cta_label:null,cta_href:null});async function U(e){let t=new FormData;t.append("name",e.name),e.description&&t.append("description",e.description),e.file&&t.append("file",e.file),e.level&&t.append("level",e.level),e.startdate&&t.append("startdate",e.startdate),e.enddate&&t.append("enddate",e.enddate),e.starttime&&t.append("starttime",e.starttime),e.endtime&&t.append("endtime",e.endtime),e.title&&t.append("title",e.title),e.cta_label&&t.append("cta_label",e.cta_label),e.cta_href&&t.append("cta_href",e.cta_href);let l=await fetch("/api/admin/hotspots/create",{method:"POST",body:t}),a=await l.json();if(l.ok)M(e=>({...e,open:!0,message:"Added Hotspot Successfully",severity:"success"}));else throw M(e=>({...e,open:!0,message:"Adding Hotspot Failed",severity:"error"})),Error((null==a?void 0:a.error)||"Create failed")}async function D(){if(!(null==y?void 0:y.id))return void M(e=>({...e,open:!0,message:"Select a hotspot to delete",severity:"error"}));if(window.confirm('Delete hotspot "'.concat(y.name,'"?'))){j(!0);try{let s=await fetch("/api/admin/hotspots/".concat(y.id),{method:"DELETE"}),n=await s.json().catch(()=>({}));if(!s.ok)throw Error((null==n?void 0:n.error)||"Failed to delete hotspot");M(e=>({...e,open:!0,message:"Hotspot deleted",severity:"success"})),await (0,r.lP)({setHotspots:x,setLoading:j}),N(null),_(!1);try{var e,l,a;null==(a=t.current)||null==(l=a.contentWindow)||null==(e=l.location)||e.reload()}catch(e){}}catch(t){let e=t instanceof Error?t.message:"Delete failed";M(t=>({...t,open:!0,message:e,severity:"error"}))}finally{j(!1)}}}(0,s.useEffect)(()=>{(0,r.lP)({setHotspots:x,setLoading:j})},[]),console.log({open:S});let F=!!y&&S;async function H(){if(!p||!I)return;E(!0);let e=p.reduce((e,t)=>(e[t.level]||(e[t.level]=[]),e[t.level].push({id:t.id,order:t.order}),e),{});try{if(!(await fetch("/api/admin/hotspots/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grouped:e})})).ok)throw Error("Failed to save order");O(!1),M(e=>({...e,open:!0,message:"Order saved successfully",severity:"success"}))}catch(e){M(t=>({...t,open:!0,message:e instanceof Error?e.message:"Save failed",severity:"error"}))}finally{E(!1)}}return console.log({isHotspotModalOpen:F}),(0,s.useEffect)(()=>{var e,t,l,a,s,n,r,i,d,o,c;y&&R({name:null!=(e=y.name)?e:"",description:null!=(t=y.description)?t:"",image_url:null!=(l=y.image_url)?l:"",id:y.id,level:null!=(a=y.level)?a:"",startdate:null!=(s=y.startdate)?s:"",enddate:null!=(n=y.enddate)?n:"",starttime:null!=(r=y.starttime)?r:"",endtime:null!=(i=y.endtime)?i:"",title:null!=(d=y.title)?d:"",cta_label:null!=(o=y.cta_label)?o:"",cta_href:null!=(c=y.cta_href)?c:""})},[y]),(0,a.jsxs)("div",{className:"font-sans flex flex-col gap-4 md:flex-row min-h-screen md:h-screen p-8 md:gap-8 sm:px-20 bg-[#151c2f]",children:[(0,a.jsxs)("div",{className:"md:w-[30%] text-white h-[90%] md:overflow-scroll custom-scrollbar shadow-xl rounded-xl bg-[#212e3f] p-3 md:p-5 space-y-4",children:[(null==L?void 0:L.role)==="super-admin"&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>n(!0),className:"bg-green-400 rounded-lg p-2 text-black hover:bg-green-500 hover:cursor-pointer",children:"Add"}),(0,a.jsx)("button",{onClick:D,disabled:!y,className:"bg-red-500 rounded-lg p-2 text-white hover:bg-red-600 hover:cursor-pointer",children:"Delete"}),(0,a.jsx)("button",{onClick:H,disabled:P||!I,className:"".concat(P?"bg-gray-400":"bg-blue-500 hover:bg-blue-600"," rounded-lg p-2 text-white transition disabled:opacity-50"),children:P?"Savingâ€¦":"Save Order"})]}),(0,a.jsx)("div",{}),(0,a.jsxs)("div",{className:"flex items-center justify-between px-4",children:[(0,a.jsx)("span",{className:"text-md text-white/60",children:null!=(e=null==y?void 0:y.level)?e:"Ammenities"}),C?(0,a.jsx)(u.A,{size:"small",onClick:()=>{k(!1),N(null)},children:(0,a.jsx)("div",{className:"border border-[rgba(255,255,255,0.1)] flex justify-center items-center p-2 rounded hover:bg-white/10 transition duration-300 ease-in-out",children:(0,a.jsx)(h.A,{htmlColor:"#9ca3af",fontSize:"small"})})}):(0,a.jsx)(u.A,{size:"small",onClick:()=>{(0,r.lP)({setHotspots:x,setLoading:j})},children:(0,a.jsx)(m.A,{className:"text-white/60 hover:cursor-pointer  hover:text-white/80"})}),(0,a.jsx)(i,{open:l,onClose:function(){n(!1)},onCreate:U})]}),!v&&!C&&(0,a.jsx)(b.JY,{onDragEnd:function(e){let{source:t,destination:l}=e;if(l){var a,s,n;t.droppableId===l.droppableId&&(a=t.droppableId,s=t.index,n=l.index,x(e=>{if(!e)return e;let t=[...e],l=t.filter(e=>e.level===a),r=l[s];l.splice(s,1),l.splice(n,0,r);let i=l.map((e,t)=>({...e,order:t})),d=[...t.filter(e=>e.level!==a),...i];return O(!0),d}))}},children:(0,a.jsx)("div",{className:"rounded-lg h-[150px] md:h-[670px] overflow-scroll custom-scrollbar space-y-2",children:(()=>{let e={};return null==p||p.forEach(t=>{let l=t.level||"Uncategorized";e[l]||(e[l]=[]),e[l].push(t)}),["Ground Level","Second Level","Third Level","Fifth Level","Sixth Level","60th Level","62nd Level","66th Level"].map(t=>(0,a.jsx)(g,{title:t,droppableId:t,items:e[t]||[],selectedHotspot:y,setSelectedHotspot:N,setOpen:_,setShowUpdate:k},t))})()})}),C&&(0,a.jsx)(f,{hotspotId:null==y?void 0:y.id,onCancel:()=>{k(!1),N(null)},onSaved:()=>{},initial:T,onChange:e=>R(e)})]}),(0,a.jsxs)("div",{className:"md:w-[70%] h-[90%] md:overflow-scroll custom-scrollbar text-white shadow-xl rounded-xl bg-[#212e3f] gap-4 p-3 md:p-5",children:[(0,a.jsx)("div",{className:"mb-2 text-sm text-white/60 w-full flex gap-x-2",children:(0,a.jsx)("span",{children:"Live preview from website"})}),(0,a.jsxs)("div",{className:"relative w-full h-[720px] md:h-full border border-white/10 bg-white rounded-xl overflow-hidden",children:[(0,a.jsx)(w.A,{xml:"/vtour/tour.xml",container:"contained"}),(0,a.jsx)(c.A,{open:F,onClose:()=>{},hotspot:T,container:"contained"})]}),(0,a.jsx)("div",{className:"mt-3 flex justify-between items-center border-t border-white/10 pt-3",children:(0,a.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)("input",{type:"checkbox",checked:S,onChange:e=>_(e.target.checked)}),(0,a.jsx)("span",{children:"Hotspot Modal popup (preview)"})]})})]}),(0,a.jsx)(d.A,{snackbarSettings:A,setSnackbarSettings:M})]})}},5695:(e,t,l)=>{"use strict";var a=l(8999);l.o(a,"usePathname")&&l.d(t,{usePathname:function(){return a.usePathname}}),l.o(a,"useRouter")&&l.d(t,{useRouter:function(){return a.useRouter}}),l.o(a,"useSearchParams")&&l.d(t,{useSearchParams:function(){return a.useSearchParams}})},6414:(e,t,l)=>{"use strict";l.d(t,{N:()=>a});let a=(0,l(3254).createBrowserClient)("https://enadqzzfyywsbictfwvg.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVuYWRxenpmeXl3c2JpY3Rmd3ZnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYxODQ1OTIsImV4cCI6MjA3MTc2MDU5Mn0.VPk2P-BIeJs01QDgUwYtn-K66onMC70WpZeYdHZbEXs")},9243:(e,t,l)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var l in t)Object.defineProperty(e,l,{enumerable:!0,get:t[l]})}(t,{default:function(){return b},handleClientScriptLoad:function(){return p},initScriptLoader:function(){return f}});let a=l(8466),s=l(3011),n=l(5155),r=a._(l(7650)),i=s._(l(2115)),d=l(2830),o=l(2714),c=l(2374),u=new Map,h=new Set,m=e=>{let{src:t,id:l,onLoad:a=()=>{},onReady:s=null,dangerouslySetInnerHTML:n,children:i="",strategy:d="afterInteractive",onError:c,stylesheets:m}=e,p=l||t;if(p&&h.has(p))return;if(u.has(t)){h.add(p),u.get(t).then(a,c);return}let f=()=>{s&&s(),h.add(p)},x=document.createElement("script"),b=new Promise((e,t)=>{x.addEventListener("load",function(t){e(),a&&a.call(this,t),f()}),x.addEventListener("error",function(e){t(e)})}).catch(function(e){c&&c(e)});n?(x.innerHTML=n.__html||"",f()):i?(x.textContent="string"==typeof i?i:Array.isArray(i)?i.join(""):"",f()):t&&(x.src=t,u.set(t,b)),(0,o.setAttributesFromProps)(x,e),"worker"===d&&x.setAttribute("type","text/partytown"),x.setAttribute("data-nscript",d),m&&(e=>{if(r.default.preinit)return e.forEach(e=>{r.default.preinit(e,{as:"style"})});{let t=document.head;e.forEach(e=>{let l=document.createElement("link");l.type="text/css",l.rel="stylesheet",l.href=e,t.appendChild(l)})}})(m),document.body.appendChild(x)};function p(e){let{strategy:t="afterInteractive"}=e;"lazyOnload"===t?window.addEventListener("load",()=>{(0,c.requestIdleCallback)(()=>m(e))}):m(e)}function f(e){e.forEach(p),[...document.querySelectorAll('[data-nscript="beforeInteractive"]'),...document.querySelectorAll('[data-nscript="beforePageRender"]')].forEach(e=>{let t=e.id||e.getAttribute("src");h.add(t)})}function x(e){let{id:t,src:l="",onLoad:a=()=>{},onReady:s=null,strategy:o="afterInteractive",onError:u,stylesheets:p,...f}=e,{updateScripts:x,scripts:b,getIsSsr:v,appDir:g,nonce:w}=(0,i.useContext)(d.HeadManagerContext);w=f.nonce||w;let j=(0,i.useRef)(!1);(0,i.useEffect)(()=>{let e=t||l;j.current||(s&&e&&h.has(e)&&s(),j.current=!0)},[s,t,l]);let y=(0,i.useRef)(!1);if((0,i.useEffect)(()=>{if(!y.current){if("afterInteractive"===o)m(e);else"lazyOnload"===o&&("complete"===document.readyState?(0,c.requestIdleCallback)(()=>m(e)):window.addEventListener("load",()=>{(0,c.requestIdleCallback)(()=>m(e))}));y.current=!0}},[e,o]),("beforeInteractive"===o||"worker"===o)&&(x?(b[o]=(b[o]||[]).concat([{id:t,src:l,onLoad:a,onReady:s,onError:u,...f,nonce:w}]),x(b)):v&&v()?h.add(t||l):v&&!v()&&m({...e,nonce:w})),g){if(p&&p.forEach(e=>{r.default.preinit(e,{as:"style"})}),"beforeInteractive"===o)if(!l)return f.dangerouslySetInnerHTML&&(f.children=f.dangerouslySetInnerHTML.__html,delete f.dangerouslySetInnerHTML),(0,n.jsx)("script",{nonce:w,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([0,{...f,id:t}])+")"}});else return r.default.preload(l,f.integrity?{as:"script",integrity:f.integrity,nonce:w,crossOrigin:f.crossOrigin}:{as:"script",nonce:w,crossOrigin:f.crossOrigin}),(0,n.jsx)("script",{nonce:w,dangerouslySetInnerHTML:{__html:"(self.__next_s=self.__next_s||[]).push("+JSON.stringify([l,{...f,id:t}])+")"}});"afterInteractive"===o&&l&&r.default.preload(l,f.integrity?{as:"script",integrity:f.integrity,nonce:w,crossOrigin:f.crossOrigin}:{as:"script",nonce:w,crossOrigin:f.crossOrigin})}return null}Object.defineProperty(x,"__nextScript",{value:!0});let b=x;("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)}},e=>{e.O(0,[1309,3254,6766,8019,4834,4033,313,8406,1921,8441,5964,7358],()=>e(e.s=3970)),_N_E=e.O()}]);