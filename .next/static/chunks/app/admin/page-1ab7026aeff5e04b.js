(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[698],{5318:(e,t,a)=>{Promise.resolve().then(a.bind(a,8117))},8117:(e,t,a)=>{"use strict";a.d(t,{default:()=>j});var l=a(5155),r=a(2115),s=a(6766);function i(e){let{open:t,onClose:a,imageUrl:r,title:i,subheading:n,description:o,dateRange:c,timeText:d,ctaLabel:u,ctaHref:h,container:x="contained"}=e;if(!t)return null;let m="contained"===x?"absolute":"fixed";return(0,l.jsxs)("div",{className:"".concat(m," inset-0 ").concat("contained"===x?"z-10":"z-[9999]"," flex items-center justify-center"),children:[(0,l.jsx)("div",{className:"".concat(m," inset-0 bg-black/60 backdrop-blur-[1px]"),onClick:a}),(0,l.jsxs)("div",{className:"relative z-10 w-full max-w-[560px] rounded-2xl bg-white shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,l.jsx)("button",{onClick:a,"aria-label":"Close",className:"absolute -right-3 -top-3 flex h-10 w-10 items-center justify-center rounded-full bg-red-600 text-white shadow-lg ring-4 ring-white",children:"\xd7"}),(0,l.jsxs)("div",{className:"px-5 pb-5 pt-6",children:[r&&(0,l.jsx)("div",{className:"relative mx-auto mb-4 h-32 w-full overflow-hidden rounded-xl sm:h-36",children:(0,l.jsx)(s.default,{src:r,alt:"",fill:!0,unoptimized:!0,className:"object-cover",sizes:"(max-width: 640px) 100vw, 560px",priority:!0})}),(0,l.jsx)("h2",{className:"text-center text-neutral-600 text-3xl font-semibold tracking-tight whitespace-pre-wrap break-words [overflow-wrap:anywhere] hyphens-auto",children:i}),!!n&&(0,l.jsx)("p",{className:"mt-1 text-center text-sm text-neutral-600 whitespace-pre-wrap break-words [overflow-wrap:anywhere] hyphens-auto",children:n}),(c||d)&&(0,l.jsxs)("div",{className:"mt-2 flex items-center justify-center gap-5 text-sm text-neutral-700",children:[c&&(0,l.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,l.jsx)("span",{className:"inline-block h-5 w-5 rounded-[4px] border border-neutral-400"}),c]}),d&&(0,l.jsxs)("span",{className:"inline-flex items-center gap-1.5",children:[(0,l.jsx)("span",{className:"inline-block h-5 w-5 rounded-full border border-neutral-400"}),d]})]}),!!o&&(0,l.jsx)("div",{className:"mt-4 max-h-56 overflow-y-auto",children:(0,l.jsx)("p",{className:"text-sm leading-relaxed text-neutral-800   whitespace-pre-wrap break-words [overflow-wrap:anywhere] hyphens-auto",children:o})}),(u||h)&&(0,l.jsx)("div",{className:"mt-6 flex justify-center",children:h?(0,l.jsx)("a",{href:h,target:"_blank",rel:"noreferrer",className:"inline-flex items-center justify-center rounded-full bg-red-600 px-6 py-3 text-sm font-semibold uppercase tracking-wide text-white shadow hover:opacity-95",children:u}):(0,l.jsx)("button",{className:"inline-flex items-center justify-center rounded-full bg-red-600 px-6 py-3 text-sm font-semibold uppercase tracking-wide text-white shadow hover:opacity-95",children:u})})]})]})]})}var n=a(4581),o=a(9267),c=a(5715),d=a(8441),u=a(804),h=a(4426),x=a(4079),m=a(3148),p=a(497),f=a(6982),g=a(9505),b=a(7857),v=a(5294),w=a(7365);function j(){let[e,t]=(0,r.useState)(""),[a,s]=(0,r.useState)(""),[j,k]=(0,r.useState)(""),[D,A]=(0,r.useState)(null),[T,E]=(0,r.useState)(null),[O,L]=(0,r.useState)(""),[z,P]=(0,r.useState)(""),[U,I]=(0,r.useState)(""),[R,M]=(0,r.useState)(!0),[H,J]=(0,r.useState)(!0),[W,_]=(0,r.useState)(""),[F,Y]=(0,r.useState)(""),[B,V]=(0,r.useState)(null),[q,G]=(0,r.useState)(0),[K,Q]=(0,r.useState)([]),[X,Z]=(0,r.useState)(!1),[$,ee]=(0,r.useState)(""),[et,ea]=(0,r.useState)({}),[el,er]=(0,r.useState)(!1),es="cmsDraft_v1",ei=(0,r.useRef)(null),en=(0,r.useRef)(null);function eo(e){A(e),E(URL.createObjectURL(e))}function ec(){t(""),s(""),k(""),L(""),P(""),I(""),M(!0),J(!0),_(""),Y(""),A(null),E(null),localStorage.removeItem(es),ee(""),ea({})}async function ed(){Z(!0);try{let e=await fetch("/api/events",{cache:"no-store"}),t=await e.json();if(!e.ok)throw Error((null==t?void 0:t.error)||"Failed to load events");let a=(t.items||[]).sort((e,t)=>{var a,l;return(null!=(a=e.order)?a:0)-(null!=(l=t.order)?l:0)});Q(a)}catch(e){console.error(e)}finally{Z(!1)}}async function eu(){try{let e=K.map(e=>e.id),t=await fetch("/api/events/reorder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({ids:e})}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Reorder failed");er(!1),alert("Order saved")}catch(e){alert(e.message||"Save failed")}}async function eh(){try{let t,l,r={title:e,subheading:a,description:j,startDate:O,endDate:z,startTime:U,ctaLabel:W,ctaHref:F,imageDataUrl:(null==T?void 0:T.startsWith("data:"))?T:null,status:"draft"};if(""==e||null==e)return void alert("Title needed");if(B&&0!==q){if(t=await fetch("/api/events/".concat(B),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),l=await t.json(),!t.ok)throw Error((null==l?void 0:l.error)||"Update failed");alert("Updated!")}else{if(t=await fetch("/api/events",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),l=await t.json(),!t.ok)throw Error((null==l?void 0:l.error)||"Create failed");let e=localStorage.getItem(es),a=e?JSON.parse(e):{};localStorage.setItem(es,JSON.stringify({...a,eventId:l.id})),0===q&&alert("Created!")}0!==q&&ed()}catch(e){alert(e.message||"Save failed")}ec()}async function ex(e){if(confirm("Delete this event?"))try{let t=await fetch("/api/events/".concat(e),{method:"DELETE"}),a=await t.json();if(!t.ok)throw Error((null==a?void 0:a.error)||"Delete failed");Q(t=>t.filter(t=>t.id!==e)),B===e&&V(null)}catch(e){alert(e.message||"Delete failed")}}(0,r.useEffect)(()=>{try{var e,a;let l=localStorage.getItem(es);if(!l)return;let r=JSON.parse(l);t(r.title||""),s(r.subheading||""),k(r.description||""),L(r.startDate||""),P(r.endDate||""),I(r.startTime||""),M(null==(e=r.publishModal)||e),J(null==(a=r.forceOpen)||a),_(r.ctaLabel||""),Y(r.ctaHref||""),r.imageDataUrl&&E(r.imageDataUrl)}catch(e){}},[]),(0,r.useEffect)(()=>{let t=setTimeout(async()=>{try{var t;let l=T;!l&&D&&(l=await (t=D,new Promise((e,a)=>{let l=new FileReader;l.onload=()=>e(String(l.result)),l.onerror=a,l.readAsDataURL(t)})),E(l)),localStorage.setItem(es,JSON.stringify({title:e,subheading:a,description:j,startDate:O,endDate:z,startTime:U,publishModal:R,forceOpen:H,ctaLabel:W,ctaHref:F,imageDataUrl:l}))}catch(e){}},300);return()=>clearTimeout(t)},[e,a,j,O,z,U,R,H,W,F,D,T]),(0,r.useEffect)(()=>{let t=setTimeout(()=>{var t,l,r;let s=T&&T.startsWith("data:")?T:null;if(!s)try{let e=localStorage.getItem(es);s=e&&null!=(r=JSON.parse(e).imageDataUrl)?r:null}catch(e){}let i={title:e,subheading:a,description:j,startDate:O,endDate:z,startTime:U,publishModal:R,forceOpen:H,ctaLabel:W,ctaHref:F,imageDataUrl:s};null==(l=en.current)||null==(t=l.contentWindow)||t.postMessage({type:"cms:update",payload:i},window.location.origin)},120);return()=>clearTimeout(t)},[e,a,j,O,z,U,R,H,W,F,T]),(0,r.useEffect)(()=>{function e(e){if(!e.clipboardData)return;let t=Array.from(e.clipboardData.items).find(e=>e.type.startsWith("image/"));if(!t)return;let a=t.getAsFile();a&&eo(a)}return window.addEventListener("paste",e),()=>window.removeEventListener("paste",e)},[]),(0,r.useEffect)(()=>{0!==q&&ed()},[q]),console.log(K),console.log(et),console.log("id",B);let em=O&&z&&new Date(z)<new Date(O)?"End date cannot be before start date.":"",ep=function(e){let{publishModal:t,forceOpen:a,startDate:l,endDate:r}=e;if(!t)return!1;if(a)return!0;let s=new Date,i=l?function(e){let t=new Date(e);return t.setHours(0,0,0,0),t}(new Date(l)):new Date(0),n=r?function(e){let t=new Date(e);return t.setHours(23,59,59,999),t}(new Date(r)):new Date(864e13);return s>=i&&s<=n}({publishModal:R,forceOpen:H,startDate:O,endDate:z}),ef=0===q||1===q&&!!$;return(0,l.jsxs)("div",{className:"font-sans flex flex-col gap-4 md:flex-row min-h-screen md:h-screen p-8 pb-20 md:gap-8 sm:px-20 bg-[#151c2f]",children:[(0,l.jsxs)("div",{className:"md:w-[30%] text-white h-[90%] md:overflow-scroll custom-scrollbar md:overflow-auto shadow-xl rounded-xl bg-[#212e3f] p-3 md:p-5 space-y-4",children:[(0,l.jsx)(n.A,{sx:{borderBottom:1,borderColor:"rgba(255,255,255,0.1)"},children:(0,l.jsxs)(o.A,{value:q,onChange:(e,t)=>{G(t),ec(),ee(""),0===t&&V(null)},variant:"fullWidth",sx:{"& .MuiTab-root":{color:"rgba(255,255,255,0.7)"},"& .Mui-selected":{color:"#fff"},"& .MuiTabs-indicator":{backgroundColor:"#60a5fa"}},children:[(0,l.jsx)(c.A,{label:"Create"}),(0,l.jsx)(c.A,{label:"Update"}),(0,l.jsx)(c.A,{label:"Order"}),(0,l.jsx)(c.A,{label:"Delete"})]})}),1===q&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsxs)(d.A,{fullWidth:!0,displayEmpty:!0,size:"small",value:$,onChange:e=>{let a=String(e.target.value);ee(a);let l=K.find(e=>e.id===a);l&&(ea(l),V(l.id),t(l.title||""),s(l.subheading||""),k(l.description||""),L(l.startDate||""),P(l.endDate||""),I(l.startTime||""),_(l.ctaLabel||""),Y(l.ctaHref||""),E(l.imageDataUrl||null))},sx:{color:"#fff","& .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.15)"},"&:hover .MuiOutlinedInput-notchedOutline":{borderColor:"rgba(255,255,255,0.3)"}},renderValue:e=>{var t;return e?(null==(t=K.find(t=>t.id===e))?void 0:t.title)+" hi":"Select event…"},children:[X&&(0,l.jsxs)(u.A,{disabled:!0,children:[(0,l.jsx)(h.A,{size:16,sx:{mr:1}})," Loading…"]}),!X&&0===K.length&&(0,l.jsx)(u.A,{disabled:!0,children:"No events yet"}),K.map(e=>(0,l.jsx)(u.A,{value:e.id,children:e.title||"(untitled)"},e.id))]}),(0,l.jsx)(x.A,{size:"small",onClick:()=>{ee(""),ec(),ed()},children:(0,l.jsx)(b.A,{htmlColor:"#9ca3af",fontSize:"small"})})]}),(0,l.jsx)("div",{className:"text-xs text-white/60",children:$?"Editing: ".concat($):"Pick an event to edit"})]}),2===q&&(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-sm text-white/80",children:"Reorder events (drag rows)"}),(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)("button",{onClick:eu,disabled:!el,className:"rounded-md bg-blue-500/90 hover:bg-blue-500 px-3 py-1.5 text-sm disabled:opacity-50",children:"Save"}),(0,l.jsx)(x.A,{size:"small",onClick:ed,children:(0,l.jsx)(b.A,{htmlColor:"#9ca3af",fontSize:"small"})})]})]}),X?(0,l.jsx)("div",{className:"flex justify-center py-4",children:(0,l.jsx)(h.A,{size:20})}):(0,l.jsx)(v.JY,{onDragEnd:function(e){if(!e.destination)return;let t=e.source.index,a=e.destination.index;t!==a&&(Q(e=>{let l=[...e],[r]=l.splice(t,1);return l.splice(a,0,r),l}),er(!0))},children:(0,l.jsx)(v.gL,{droppableId:"events-order",children:e=>(0,l.jsxs)("ul",{ref:e.innerRef,...e.droppableProps,className:"divide-y divide-white/10 rounded-lg h-[150px] md:h-[550px] overflow-scroll custom-scrollbar",children:[K.map((e,t)=>(0,l.jsx)(v.sx,{draggableId:e.id,index:t,children:a=>(0,l.jsxs)("li",{ref:a.innerRef,...a.draggableProps,className:"flex items-center justify-between even:bg-[#151c2f] p-2  hover:bg-white/10",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)("span",{...a.dragHandleProps,className:"text-white/60 cursor-grab active:cursor-grabbing",title:"Drag to reorder",children:(0,l.jsx)(w.A,{fontSize:"small"})}),(0,l.jsx)("span",{className:"w-6 text-white/60 text-xs tabular-nums",children:t+1}),(0,l.jsx)("span",{className:"text-white",children:e.title||"(untitled)"})]}),(0,l.jsx)("span",{className:"text-xs text-white/40",children:e.id})]})},e.id)),e.placeholder,0===K.length&&(0,l.jsx)("li",{className:"p-3 text-sm text-white/60",children:"No events yet."})]})})})]}),3===q&&(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("div",{className:"text-sm text-white/80",children:"Delete events"}),(0,l.jsx)(x.A,{size:"small",onClick:()=>{ed(),ec()},children:(0,l.jsx)(b.A,{htmlColor:"#9ca3af",fontSize:"small"})})]}),X?(0,l.jsx)("div",{className:"flex justify-center py-4",children:(0,l.jsx)(h.A,{size:20})}):(0,l.jsxs)(m.A,{dense:!0,className:"h-[150px] md:h-[600px] overflow-scroll custom-scrollbar",children:[K.map(e=>(0,l.jsx)(p.Ay,{className:"",secondaryAction:(0,l.jsx)(x.A,{edge:"end","aria-label":"delete",onClick:()=>{ex(e.id)},children:(0,l.jsx)(g.A,{htmlColor:"#fca5a5"})}),onClick:()=>{let a=e.id;ee(a);let l=K.find(e=>e.id===a);l&&(V(l.id),t(l.title||""),s(l.subheading||""),k(l.description||""),L(l.startDate||""),P(l.endDate||""),I(l.startTime||""),_(l.ctaLabel||""),Y(l.ctaHref||""),E(l.imageDataUrl||null)),console.log(e.id)},children:(0,l.jsx)(f.A,{primary:e.title||"(untitled)",secondary:e.id,primaryTypographyProps:{color:"#fff"},secondaryTypographyProps:{color:"rgba(255,255,255,0.5)"}})},e.id)),0===K.length&&(0,l.jsx)("div",{className:"text-white/60 text-sm px-2 py-4",children:"No events yet."})]})]}),ef&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("div",{className:"border border-dashed rounded-xl h-48 flex items-center justify-center relative hover:border-white/60 transition-colors cursor-pointer group",onClick:function(){var e;null==(e=ei.current)||e.click()},onDrop:function(e){var t;e.preventDefault();let a=null==(t=e.dataTransfer.files)?void 0:t[0];a&&a.type.startsWith("image/")&&eo(a)},onDragOver:function(e){e.preventDefault()},title:"Click, drag & drop, or paste an image",children:[T?(0,l.jsx)("img",{src:T,alt:"Preview",className:"absolute inset-0 w-full h-full object-cover rounded-xl"}):(0,l.jsxs)("div",{className:"text-center text-white/70 px-4",children:[(0,l.jsx)("div",{className:"text-sm",children:"Image Upload"}),(0,l.jsx)("div",{className:"text-xs mt-1 opacity-80",children:"Click, drag & drop, or paste"})]}),(0,l.jsx)("div",{className:"absolute inset-0 rounded-xl ring-0 group-hover:ring-2 ring-white/10 pointer-events-none"}),(0,l.jsx)("input",{ref:ei,type:"file",accept:"image/*",onChange:function(e){var t;let a=null==(t=e.target.files)?void 0:t[0];a&&eo(a)},className:"hidden"})]}),(0,l.jsx)(N,{label:"Title",value:e,onChange:t,placeholder:"Enter title"}),(0,l.jsx)(N,{label:"Subheading",value:a,onChange:s,placeholder:"Optional subheading"}),(0,l.jsx)(y,{label:"Description",value:j,onChange:k,placeholder:"Write a short description...",rows:3}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsx)(C,{label:"Start date",value:O,onChange:L}),(0,l.jsx)(C,{label:"End date",value:z,onChange:P,min:O||void 0})]}),(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("div",{className:"text-sm mb-1 text-white/80",children:"Start time"}),(0,l.jsx)("input",{type:"time",value:U,onChange:e=>I(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]}),em&&(0,l.jsx)("div",{className:"text-xs text-red-300",children:em}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,l.jsx)(N,{label:"CTA label",value:W,onChange:_,placeholder:"Learn More"}),(0,l.jsx)(N,{label:"CTA link",value:F,onChange:Y,placeholder:"https://example.com"})]}),(0,l.jsx)("div",{className:"text-xs text-white/60",children:(0,l.jsxs)("div",{className:"mt-1",children:[j.length," chars"]})}),(0,l.jsxs)("div",{className:"flex gap-2 pt-2",children:[(0,l.jsx)("button",{onClick:eh,className:"px-3 py-2 rounded-lg bg-emerald-500/90 hover:bg-emerald-500 text-black font-medium",children:0!==q&&B?"Update":"Create"}),(0,l.jsx)("button",{onClick:ec,className:"px-3 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white",children:"Clear"})]})]})]}),(0,l.jsxs)("div",{className:"md:w-[70%] h-[90%] md:overflow-scroll custom-scrollbar md:overflow-auto text-white shadow-xl rounded-xl bg-[#212e3f] gap-4 p-3 md:p-5",children:[(0,l.jsx)("div",{className:"mb-2 text-sm text-white/60",children:"Live preview from website"}),(0,l.jsxs)("div",{className:"relative w-full h-[720px] md:h-full border border-white/10 bg-white rounded-xl overflow-hidden",children:[(0,l.jsx)("iframe",{ref:en,src:"/",title:"Website Live Preview",className:"absolute inset-0 w-full h-full"}),(0,l.jsx)(i,{container:"contained",open:ep,onClose:()=>setDismissed(!0),imageUrl:T||void 0,title:e||"",subheading:a,description:j,dateRange:function(e,t){if(!e&&!t)return"";if(e&&!t)return S(e);if(!e&&t)return S(t);let a=new Date(e),l=new Date(t);if(isNaN(a.getTime())||isNaN(l.getTime()))return"";if(a.getFullYear()===l.getFullYear()&&a.getMonth()===l.getMonth()){let e=a.toLocaleString(void 0,{month:"short"});return"".concat(e," ").concat(a.getDate(),"–").concat(l.getDate(),", ").concat(a.getFullYear())}return"".concat(S(e)," – ").concat(S(t))}(O,z),timeText:function(e){if(!e)return"";let[t,a]=e.split(":").map(Number),l=new Date;return l.setHours(null!=t?t:0,null!=a?a:0,0,0),l.toLocaleTimeString([],{hour:"numeric",minute:"2-digit"})}(U),ctaLabel:W,ctaHref:F})]}),(0,l.jsx)("div",{className:"mt-3 flex justify-between items-center border-t border-white/10 pt-3",children:(0,l.jsxs)("label",{className:"flex items-center gap-2 text-sm",children:[(0,l.jsx)("input",{type:"checkbox",checked:R,onChange:e=>M(e.target.checked)}),(0,l.jsx)("span",{children:"Publish event popup (preview)"})]})})]})]})}function N(e){let{label:t,value:a,onChange:r,placeholder:s}=e;return(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("div",{className:"text-sm mb-1 text-white/80",children:t}),(0,l.jsx)("input",{value:a,onChange:e=>r(e.target.value),placeholder:s,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})}function y(e){let{label:t,value:a,onChange:r,placeholder:s,rows:i=5}=e;return(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("div",{className:"text-sm mb-1 text-white/80",children:t}),(0,l.jsx)("textarea",{value:a,onChange:e=>r(e.target.value),placeholder:s,rows:i,className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30 resize-y"})]})}function C(e){let{label:t,value:a,onChange:r,min:s,max:i}=e;return(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("div",{className:"text-sm mb-1 text-white/80",children:t}),(0,l.jsx)("input",{type:"date",value:a,min:s,max:i,onChange:e=>r(e.target.value),className:"w-full rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30"})]})}function S(e){let t=new Date(e);return isNaN(t.getTime())?"":t.toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"})}}},e=>{e.O(0,[309,63,762,441,964,358],()=>e(e.s=5318)),_N_E=e.O()}]);