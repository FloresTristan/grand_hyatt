(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[733],{2429:(e,t,s)=>{"use strict";s.d(t,{default:()=>d});var l=s(5155),a=s(2115),r=s(3649),n=s(313);function i(e){let{open:t,mode:s,initial:r,onClose:i,onSubmit:d}=e,[o,c]=(0,a.useState)(""),[u,x]=(0,a.useState)(""),[m,h]=(0,a.useState)("editor"),[p,f]=(0,a.useState)(""),[b,g]=(0,a.useState)(""),[j,v]=(0,a.useState)(!1),[w,N]=(0,a.useState)(null);async function y(e){e.preventDefault(),N(null),v(!0);try{if("create"===s&&p.length<6)throw Error("Password must be at least 6 characters.");await d({email:o,displayName:u,role:m,..."create"===s?{password:p}:{},..."edit"===s?{newPassword:b}:{}})}catch(e){N((null==e?void 0:e.message)||"Save failed"),v(!1);return}v(!1)}return(0,a.useEffect)(()=>{t&&(N(null),v(!1),"edit"===s&&r?(c(r.email||""),x(r.displayName||""),h(r.role||"editor")):(c(""),x(""),h("editor")),f(""),g(""))},[t,s,r]),(0,l.jsxs)(n.lG,{open:t,onClose:i,className:"relative z-[100]",children:[(0,l.jsx)(n.Xi,{className:"fixed inset-0 bg-black/60"}),(0,l.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,l.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,l.jsxs)(n.Lj,{className:"w-full max-w-lg rounded-2xl bg-[#212e3f] text-white p-6 shadow-xl",children:[(0,l.jsx)(n.L3,{className:"text-lg font-semibold",children:"create"===s?"Add user":"Edit user"}),(0,l.jsxs)("form",{onSubmit:y,className:"mt-4 space-y-3",children:[(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("div",{className:"mb-1 text-xs text-white",children:"Email"}),(0,l.jsx)("input",{type:"email",value:o,onChange:e=>c(e.target.value),disabled:"edit"===s,required:!0,className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400 disabled:bg-neutral-700"})]}),(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("div",{className:"mb-1 text-xs ",children:"Display name"}),(0,l.jsx)("input",{value:u,onChange:e=>x(e.target.value),required:!0,className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400"})]}),(0,l.jsx)("div",{className:"grid grid-cols-2 gap-3",children:(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("div",{className:"mb-1 text-xs ",children:"Role"}),(0,l.jsxs)("select",{value:m,onChange:e=>h(e.target.value),className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400",children:[(0,l.jsx)("option",{value:"admin",className:"bg-[#212e3f]",children:"admin"}),(0,l.jsx)("option",{value:"editor",className:"bg-[#212e3f]",children:"editor"})]})]})}),"create"===s?(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("div",{className:"mb-1 text-xs ",children:"Password"}),(0,l.jsx)("input",{type:"password",minLength:6,value:p,onChange:e=>f(e.target.value),required:!0,className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400"})]}):(0,l.jsxs)("label",{className:"block",children:[(0,l.jsx)("div",{className:"mb-1 text-xs ",children:"New password (optional)"}),(0,l.jsx)("input",{type:"password",minLength:6,value:b,onChange:e=>g(e.target.value),placeholder:"Leave blank to keep current",className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400"})]}),w&&(0,l.jsx)("div",{className:"text-sm text-red-600",children:w}),(0,l.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,l.jsx)("button",{type:"button",onClick:i,className:"rounded-lg bg-red-500 px-3 py-2 text-sm hover:bg-red-400",children:"Cancel"}),(0,l.jsx)("button",{disabled:j,className:"rounded-lg bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-500 disabled:opacity-60",children:j?(0,l.jsx)("span",{className:"inline-flex items-center px-3 gap-2",children:(0,l.jsxs)("svg",{className:"h-4 w-4 animate-spin",viewBox:"0 0 24 24",fill:"none","aria-hidden":"true",children:[(0,l.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,l.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8v4A4 4 0 004 12z"})]})}):"Save"})]})]})]})})})]})}function d(){let[e,t]=(0,a.useState)([]),[s,n]=(0,a.useState)(!1),[d,x]=(0,a.useState)(null),[m,h]=(0,a.useState)(!1),[p,f]=(0,a.useState)("create"),[b,g]=(0,a.useState)(null),[j,v]=(0,a.useState)({open:!1,message:"",severity:""}),[w,N]=(0,a.useState)("");async function y(){x(null),n(!0);try{let e=await fetch("/api/admin/users",{cache:"no-store"}),s=await e.json();if(!e.ok)throw Error((null==s?void 0:s.error)||"Failed to load users");let l=[...s.items].sort((e,t)=>{var s,l;return(null!=(s=t.createdAt)?s:0)-(null!=(l=e.createdAt)?l:0)});t(l)}catch(e){console.log(e),x("Load failed")}finally{n(!1)}}(0,a.useEffect)(()=>{y()},[]);let C=(0,a.useMemo)(()=>{let t=w.trim().toLowerCase();return t?e.filter(e=>{var s,l,a;return(null==(s=e.email)?void 0:s.toLowerCase().includes(t))||(null==(l=e.displayName)?void 0:l.toLowerCase().includes(t))||(null==(a=e.role)?void 0:a.toLowerCase().includes(t))}):e},[e,w]);async function S(e){if(confirm("Delete user ".concat(e.email,"?")))try{let s=await fetch("/api/admin/users/".concat(e.uid),{method:"DELETE"}),l=await s.json().catch(()=>({}));if(!s.ok)throw Error((null==l?void 0:l.error)||"Delete failed");t(t=>t.filter(t=>t.uid!==e.uid))}catch(e){console.log(e),alert("Delete failed")}}async function k(e,s){try{if("create"===p){let t=await fetch("/api/admin/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password,name:e.displayName,role:e.role})}),s=await t.json();if(t.ok)v(e=>({...e,open:!0,message:"Created User Successfully ",severity:"success"}));else throw v(e=>({...e,open:!0,message:"User Creation failed",severity:"error"})),Error((null==s?void 0:s.error)||"Create failed");await y()}else{let l=s.uid,a={displayName:e.displayName,role:e.role};e.newPassword&&e.newPassword.length>=6&&(a.password=e.newPassword);let r=await fetch("/api/admin/users/".concat(l),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}),n=await r.json();if(r.ok)v(e=>({...e,open:!0,message:"User Updated Successfully",severity:"success"}));else throw v(e=>({...e,open:!0,message:"User Update failed",severity:"error"})),Error((null==n?void 0:n.error)||"Update failed");t(t=>t.map(t=>t.uid===l?{...t,displayName:e.displayName,role:e.role}:t))}h(!1)}catch(e){alert((null==e?void 0:e.message)||"Save failed")}}return(0,l.jsxs)("div",{className:"min-h-screen bg-[#151c2f] text-white p-6",children:[(0,l.jsxs)("div",{className:"mx-auto max-w-5xl space-y-4",children:[(0,l.jsx)("header",{className:"md:flex flex-col md:flex-row items-center justify-end",children:(0,l.jsxs)("div",{className:"flex justify-center items-center gap-2",children:[(0,l.jsx)("input",{value:w,onChange:e=>N(e.target.value),placeholder:"Search users…",className:"rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30 text-sm"}),(0,l.jsx)("button",{onClick:function(){f("create"),g(null),h(!0)},className:"rounded-lg bg-emerald-500/90 hover:bg-emerald-500 text-black font-medium px-3 py-2 text-sm",children:"+ Add user"})]})}),d&&(0,l.jsx)("div",{className:"text-sm text-red-300",children:d}),(0,l.jsx)("div",{className:"h-[60vh] rounded-xl border overflow-scroll custom-scrollbar border-white/10 bg-[#212e3f]",children:(0,l.jsxs)("table",{className:"w-full text-sm",children:[(0,l.jsx)("thead",{className:"bg-white/5 ",children:(0,l.jsxs)("tr",{children:[(0,l.jsx)(o,{children:"Email"}),(0,l.jsx)(o,{children:"Name"}),(0,l.jsx)(o,{children:"Role"}),(0,l.jsx)(o,{children:"Created"}),(0,l.jsx)(o,{align:"right",children:"Actions"})]})}),(0,l.jsx)("tbody",{children:s?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:6,className:"p-4 text-center text-white/60",children:"Loading…"})}):0===C.length?(0,l.jsx)("tr",{children:(0,l.jsx)("td",{colSpan:6,className:"p-6 text-center text-white/60",children:"No users found."})}):C.map(e=>(0,l.jsxs)("tr",{className:"border-t border-white/10 even:bg-white/5",children:[(0,l.jsx)(c,{children:e.email}),(0,l.jsx)(c,{children:e.displayName||"—"}),(0,l.jsx)(c,{children:(0,l.jsx)(u,{role:e.role})}),(0,l.jsx)(c,{children:e.createdAt?new Date(e.createdAt).toLocaleString():"—"}),(0,l.jsx)(c,{align:"right",children:(0,l.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,l.jsx)("button",{className:"rounded-md bg-white/10 hover:bg-white/20 px-2 py-1",onClick:()=>{f("edit"),g(e),h(!0)},children:"Edit"}),(0,l.jsx)("button",{className:"rounded-md bg-red-600 hover:bg-red-500 px-2 py-1",onClick:()=>S(e),children:"Delete"})]})})]},e.uid))})]})}),(0,l.jsx)(i,{open:m,mode:p,initial:b,onClose:()=>h(!1),onSubmit:e=>k(e,b)})]}),(0,l.jsx)(r.A,{snackbarSettings:j,setSnackbarSettings:v})]})}function o(e){let{children:t,align:s="left"}=e;return(0,l.jsx)("th",{className:"px-3 py-2 text-xs font-semibold uppercase tracking-wide text-white/70 ".concat("right"===s?"text-right":"text-left"),children:t})}function c(e){let{children:t,align:s="left"}=e;return(0,l.jsx)("td",{className:"px-3 py-2 ".concat("right"===s?"text-right":"text-left"),children:t})}function u(e){let{role:t}=e,s=t||"user";return(0,l.jsx)("span",{className:"rounded-full px-2 py-0.5 text-xs ".concat({admin:"bg-red-500/20 text-red-300",editor:"bg-blue-500/20 text-blue-300",user:"bg-white/10 text-white/70"}[s]),children:s})}},3649:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var l=s(5155),a=s(5726),r=s(2302),n=s(8534);function i(e){let{snackbarSettings:t,setSnackbarSettings:s}=e,{open:i,message:d,severity:o,actionLabel:c,actionCallback:u,duration:x}=t,m=()=>{s(e=>({...e,open:!1,actionLable:null,actionCallback:null}))};return(0,l.jsx)(a.A,{open:i,autoHideDuration:void 0!==x?x:2e3,anchorOrigin:{vertical:"top",horizontal:"center"},onClose:m,children:(0,l.jsx)(r.A,{severity:o,variant:"standard",className:"w-full",onClose:m,action:c&&u?(0,l.jsx)(n.A,{color:"error",size:"small",onClick:()=>{u&&(u(),s(e=>({...e,open:!1})))},children:c}):null,children:d})})}},7996:(e,t,s)=>{Promise.resolve().then(s.bind(s,2429))}},e=>{e.O(0,[834,313,441,964,358],()=>e(e.s=7996)),_N_E=e.O()}]);