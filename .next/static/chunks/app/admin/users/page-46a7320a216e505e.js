(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[733],{4137:(e,t,l)=>{"use strict";l.d(t,{default:()=>n});var a=l(5155),s=l(2115),r=l(313);function n(){let[e,t]=(0,s.useState)([]),[l,r]=(0,s.useState)(!1),[n,u]=(0,s.useState)(null),[x,h]=(0,s.useState)(!1),[m,p]=(0,s.useState)("create"),[b,f]=(0,s.useState)(null),[j,g]=(0,s.useState)("");async function w(){u(null),r(!0);try{let e=await fetch("/api/admin/users",{cache:"no-store"}),l=await e.json();if(!e.ok)throw Error((null==l?void 0:l.error)||"Failed to load users");let a=[...l.items].sort((e,t)=>{var l,a;return(null!=(l=t.createdAt)?l:0)-(null!=(a=e.createdAt)?a:0)});t(a)}catch(e){console.log(e),u("Load failed")}finally{r(!1)}}(0,s.useEffect)(()=>{w()},[]);let N=(0,s.useMemo)(()=>{let t=j.trim().toLowerCase();return t?e.filter(e=>{var l,a,s;return(null==(l=e.email)?void 0:l.toLowerCase().includes(t))||(null==(a=e.displayName)?void 0:a.toLowerCase().includes(t))||(null==(s=e.role)?void 0:s.toLowerCase().includes(t))}):e},[e,j]);async function v(e){if(confirm("Delete user ".concat(e.email,"?")))try{let l=await fetch("/api/admin/users/".concat(e.uid),{method:"DELETE"}),a=await l.json().catch(()=>({}));if(!l.ok)throw Error((null==a?void 0:a.error)||"Delete failed");t(t=>t.filter(t=>t.uid!==e.uid))}catch(e){console.log(e),alert("Delete failed")}}async function y(e,l){try{if("create"===m){let t=await fetch("/api/admin/users/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e.email,password:e.password,name:e.displayName,role:e.role})}),l=await t.json();if(!t.ok)throw Error((null==l?void 0:l.error)||"Create failed");await w()}else{let a=l.uid,s={displayName:e.displayName,role:e.role};e.newPassword&&e.newPassword.length>=6&&(s.password=e.newPassword);let r=await fetch("/api/admin/users/".concat(a),{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),n=await r.json();if(!r.ok)throw Error((null==n?void 0:n.error)||"Update failed");t(t=>t.map(t=>t.uid===a?{...t,displayName:e.displayName,role:e.role}:t))}h(!1)}catch(e){alert((null==e?void 0:e.message)||"Save failed")}}return(0,a.jsx)("div",{className:"min-h-screen bg-[#151c2f] text-white p-6",children:(0,a.jsxs)("div",{className:"mx-auto max-w-5xl space-y-4",children:[(0,a.jsxs)("header",{className:"flex items-center justify-between",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Users"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{value:j,onChange:e=>g(e.target.value),placeholder:"Search users…",className:"rounded-lg bg-[#131a2a] border border-white/10 px-3 py-2 outline-none focus:border-white/30 text-sm"}),(0,a.jsx)("button",{onClick:function(){p("create"),f(null),h(!0)},className:"rounded-lg bg-emerald-500/90 hover:bg-emerald-500 text-black font-medium px-3 py-2 text-sm",children:"+ Add user"})]})]}),n&&(0,a.jsx)("div",{className:"text-sm text-red-300",children:n}),(0,a.jsx)("div",{className:"overflow-hidden rounded-xl border border-white/10 bg-[#212e3f]",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{className:"bg-white/5",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)(i,{children:"Email"}),(0,a.jsx)(i,{children:"Name"}),(0,a.jsx)(i,{children:"Role"}),(0,a.jsx)(i,{children:"Created"}),(0,a.jsx)(i,{align:"right",children:"Actions"})]})}),(0,a.jsx)("tbody",{children:l?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"p-4 text-center text-white/60",children:"Loading…"})}):0===N.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"p-6 text-center text-white/60",children:"No users found."})}):N.map(e=>(0,a.jsxs)("tr",{className:"border-t border-white/10",children:[(0,a.jsx)(d,{children:e.email}),(0,a.jsx)(d,{children:e.displayName||"—"}),(0,a.jsx)(d,{children:(0,a.jsx)(o,{role:e.role})}),(0,a.jsx)(d,{children:e.createdAt?new Date(e.createdAt).toLocaleString():"—"}),(0,a.jsx)(d,{align:"right",children:(0,a.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,a.jsx)("button",{className:"rounded-md bg-white/10 hover:bg-white/20 px-2 py-1",onClick:()=>{p("edit"),f(e),h(!0)},children:"Edit"}),(0,a.jsx)("button",{className:"rounded-md bg-red-600 hover:bg-red-500 px-2 py-1",onClick:()=>v(e),children:"Delete"})]})})]},e.uid))})]})}),(0,a.jsx)(c,{open:x,mode:m,initial:b,onClose:()=>h(!1),onSubmit:e=>y(e,b)})]})})}function i(e){let{children:t,align:l="left"}=e;return(0,a.jsx)("th",{className:"px-3 py-2 text-xs font-semibold uppercase tracking-wide text-white/70 ".concat("right"===l?"text-right":"text-left"),children:t})}function d(e){let{children:t,align:l="left"}=e;return(0,a.jsx)("td",{className:"px-3 py-2 ".concat("right"===l?"text-right":"text-left"),children:t})}function o(e){let{role:t}=e,l=t||"user";return(0,a.jsx)("span",{className:"rounded-full px-2 py-0.5 text-xs ".concat({admin:"bg-red-500/20 text-red-300",editor:"bg-blue-500/20 text-blue-300",user:"bg-white/10 text-white/70"}[l]),children:l})}function c(e){let{open:t,mode:l,initial:n,onClose:i,onSubmit:d}=e,[o,c]=(0,s.useState)(""),[u,x]=(0,s.useState)(""),[h,m]=(0,s.useState)("editor"),[p,b]=(0,s.useState)(""),[f,j]=(0,s.useState)(""),[g,w]=(0,s.useState)(!1),[N,v]=(0,s.useState)(null);async function y(e){e.preventDefault(),v(null),w(!0);try{if("create"===l&&p.length<6)throw Error("Password must be at least 6 characters.");await d({email:o,displayName:u,role:h,..."create"===l?{password:p}:{},..."edit"===l?{newPassword:f}:{}})}catch(e){v((null==e?void 0:e.message)||"Save failed"),w(!1);return}w(!1)}return(0,s.useEffect)(()=>{t&&(v(null),w(!1),"edit"===l&&n?(c(n.email||""),x(n.displayName||""),m(n.role||"editor")):(c(""),x(""),m("editor")),b(""),j(""))},[t,l,n]),(0,a.jsxs)(r.lG,{open:t,onClose:i,className:"relative z-[100]",children:[(0,a.jsx)(r.Xi,{className:"fixed inset-0 bg-black/60"}),(0,a.jsx)("div",{className:"fixed inset-0 overflow-y-auto",children:(0,a.jsx)("div",{className:"flex min-h-full items-center justify-center p-4",children:(0,a.jsxs)(r.Lj,{className:"w-full max-w-lg rounded-2xl bg-[#212e3f] text-white p-6 shadow-xl",children:[(0,a.jsx)(r.L3,{className:"text-lg font-semibold",children:"create"===l?"Add user":"Edit user"}),(0,a.jsxs)("form",{onSubmit:y,className:"mt-4 space-y-3",children:[(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-xs text-white",children:"Email"}),(0,a.jsx)("input",{type:"email",value:o,onChange:e=>c(e.target.value),disabled:"edit"===l,required:!0,className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400 disabled:bg-neutral-100"})]}),(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-xs ",children:"Display name"}),(0,a.jsx)("input",{value:u,onChange:e=>x(e.target.value),required:!0,className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400"})]}),(0,a.jsx)("div",{className:"grid grid-cols-2 gap-3",children:(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-xs ",children:"Role"}),(0,a.jsxs)("select",{value:h,onChange:e=>m(e.target.value),className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400",children:[(0,a.jsx)("option",{value:"admin",className:"bg-[#212e3f]",children:"admin"}),(0,a.jsx)("option",{value:"editor",className:"bg-[#212e3f]",children:"editor"})]})]})}),"create"===l?(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-xs ",children:"Password"}),(0,a.jsx)("input",{type:"password",minLength:6,value:p,onChange:e=>b(e.target.value),required:!0,className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400"})]}):(0,a.jsxs)("label",{className:"block",children:[(0,a.jsx)("div",{className:"mb-1 text-xs ",children:"New password (optional)"}),(0,a.jsx)("input",{type:"password",minLength:6,value:f,onChange:e=>j(e.target.value),placeholder:"Leave blank to keep current",className:"w-full rounded-lg border border-neutral-200 px-3 py-2 outline-none focus:border-neutral-400"})]}),N&&(0,a.jsx)("div",{className:"text-sm text-red-600",children:N}),(0,a.jsxs)("div",{className:"mt-4 flex justify-end gap-2",children:[(0,a.jsx)("button",{type:"button",onClick:i,className:"rounded-lg bg-red-500 px-3 py-2 text-sm hover:bg-red-400",children:"Cancel"}),(0,a.jsx)("button",{disabled:g,className:"rounded-lg bg-emerald-600 px-3 py-2 text-sm font-medium text-white hover:bg-emerald-500 disabled:opacity-60",children:g?"Saving…":"create"===l?"Create":"Save"})]})]})]})})})]})}},9380:(e,t,l)=>{Promise.resolve().then(l.bind(l,4137))}},e=>{e.O(0,[313,441,964,358],()=>e(e.s=9380)),_N_E=e.O()}]);